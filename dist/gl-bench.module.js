class GPU {

  constructor(fpsLogger, measureLogger, gl, ext) {
    this.fpsLogger = fpsLogger;
    this.measureLogger = measureLogger;
    this.gl = gl;
    this.ext = ext;

    this.frameId = 0;
    this.elapsedAccum = 0;
    this.measureAccum = 0;
    this.queue = [{ query: this.gl.createQuery(), isMeasure: false, frameId: this.frameId }];
  }

  begin() {
    if (typeof this.queryId == 'undefined') {
      this.queryId = 0;
      this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT, this.queue[0].query);
    } else {
      this.frameId++;
      this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);
      while (!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT) && this.queue[this.queryId] &&
          this.gl.getQueryParameter(this.queue[this.queryId].query, this.gl.QUERY_RESULT_AVAILABLE)) {
        
        const dt = this.gl.getQueryParameter(this.queue[this.queryId].query, this.gl.QUERY_RESULT);
        this.elapsedAccum += dt;
        this.measureAccum += this.queue[this.queryId].isMeasure ? dt : 0;
        let seconds = this.elapsedAccum / 1e9;

        this.queryId++;
        
        if (seconds >= 1) {
          const fps = (this.queue[this.queryId-1].frameId - this.queue[0].frameId) / seconds;
          const avgMeasure = 100 * this.measureAccum / this.elapsedAccum;
          while (seconds >= 1) {
            this.fpsLogger(fps);
            this.measureLogger(avgMeasure);
            seconds--;
          }
          this.queue.slice(0, this.queryId).forEach(q => this.gl.deleteQuery(q.query));
          this.queue.splice(0, this.queryId);
          this.elapsedAccum = 0;
          this.measureAccum = 0;
          this.queryId = 0;
        }
      }

      this.queue.push({ query: this.gl.createQuery(), isMeasure: false, frameId: this.frameId });
      this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT, this.queue[this.queue.length-1].query);
    }
  }

  end() {
    this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);
    this.queue[this.queue.length-1].isMeasure = true;

    this.queue.push({ query: this.gl.createQuery(), isMeasure: false, frameId: this.frameId });
    this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT, this.queue[this.queue.length-1].query);
  }
}

class CPU {

  constructor(fpsLogger, measureLogger) {
    this.fpsLogger = fpsLogger;
    this.measureLogger = measureLogger;
    this.frameCount = 0;
    this.measureAccum = 0;
  }

  now() {
    return (typeof performance == 'undefined') ? Date.now() : performance.now();
  }

  begin() {
    if (typeof this.zerotime == 'undefined') {
      this.zerotime = this.now();
      this.timestamp = this.zerotime;
    } else {
      this.frameCount++;
      this.timestamp = this.now();

      const elapsed = this.timestamp - this.zerotime;
      let seconds = elapsed / 1e3;
      if (seconds >= 1) {
        const fps = this.frameCount / seconds;
        const avgMeasure = 100 * this.measureAccum / elapsed;
        while (seconds >= 1) {
          this.fpsLogger(fps);
          this.measureLogger(avgMeasure);
          seconds--;
        }
        this.measureAccum = 0;
        this.frameCount = 0;
        this.zerotime = this.timestamp;
      }
    }
  }

  end() {
    this.measureAccum += this.now() - this.timestamp;
  }
}

var UIFull = "<svg viewBox=\"0 0 100 70\" class=\"gl-bench\">\n\n<rect x=\"0\" y=\"0\" width=\"100\" height=\"70\" rx=\"25\" ry=\"25\" id=\"gl-bench-rect\"\n  style=\"fill:#999;stroke-width:0;opacity:0.7\"/>\n\n<text x=\"25\" y=\"22\" class=\"gl-bench-text\" font-size=\"0.7em\" id=\"gl-bench-cpu\">00%</text>\n<text x=\"25\" y=\"33\" class=\"gl-bench-text\" font-size=\"0.7em\">CPU</text>\n<circle cx=\"26.5\" cy=\"26.5\" r=\"20\" stroke-width=\"3.5\"\n  fill=\"none\" stroke=\"black\" style=\"opacity:0.4\"/>\n\n<circle cx=\"74.5\" cy=\"26.5\" r=\"20\" stroke-width=\"3.5\"\n  fill=\"none\" stroke=\"black\" style=\"opacity:0.4\"/>\n<text x=\"75\" y=\"22\" class=\"gl-bench-text\" font-size=\"0.7em\" id=\"gl-bench-gpu\">00%</text>\n<text x=\"75\" y=\"33\" class=\"gl-bench-text\" font-size=\"0.7em\">GPU</text>\n\n<text x=\"50\" y=\"59\" class=\"gl-bench-text\" font-size=\".8em\" id=\"gl-bench-fps\">00 FPS</text>\n<circle cx=\"18\" cy=\"58\" r=\"3\" style=\"opacity:0.4\"/>\n<circle cx=\"82\" cy=\"58\" r=\"3\" style=\"opacity:0.4\"/>\n\n</svg>";

var UIMin = "<svg viewBox=\"0 0 95 50\" class=\"gl-bench\">\n\n<rect x=\"0\" y=\"0\" width=\"95\" height=\"50\" rx=\"25\" ry=\"25\" id=\"gl-bench-rect\"\n  style=\"fill:#999;stroke:black;stroke-width:0;opacity:0.7\" />\n\n<text x=\"25\" y=\"20\" class=\"gl-bench-text\" font-size=\"0.7em\" id=\"gl-bench-cpu\">00%</text>\n<text x=\"25\" y=\"33\" class=\"gl-bench-text\" font-size=\"0.7em\">CPU</text>\n<circle cx=\"25\" cy=\"25\" r=\"20\" fill=\"none\"\n  stroke-width=\"3\" stroke=\"black\" style=\"opacity:0.4\"/>\n\n<text x=\"70\" y=\"27\" class=\"gl-bench-text\" font-size=\"0.75em\" id=\"gl-bench-fps\">00 FPS</text>\n\n</svg>";

var UIStyle = "#gl-bench-dom {\n  position: absolute;\n  left: 0;\n  top: 0;\n  margin: 0;\n}\n\n.gl-bench {\n  position: relative;\n  display: block;\n  margin: 5px;\n  cursor: pointer;\n  width: 100px;\n}\n\n.gl-bench-text {\n  font-family: sans-serif;\n  font-weight: 700;\n  dominant-baseline: middle;\n  text-anchor: middle;\n  opacity: 0.7;\n}\n";

/**
* WebGL-Benchmark Class
* @param { Boolean | undefined } isDefaultUI
* @param { Object | undefined } specificLoggers
*/
class GlBench {
  constructor(isDefaultUI = true, specificLoggers = null) {
    this.isDefaultUI = isDefaultUI;
    this.isDefaultLoggers = !specificLoggers;
    this.loggers = specificLoggers ? specificLoggers : {};
  }

  /**
   * Expicit initialization
   * @param { HTMLCanvasElement | undefined } targetCanvas 
   */
  init(targetCanvas = null) {

    // chose biggest canvas if not specified
    if (!targetCanvas) {
      let cs = document.getElementsByTagName('canvas');
      for (let i = 0; i < cs.length; i++) {
        if (i == 0 || targetCanvas.width * targetCanvas.height < cs[i].width * cs[i].height) {
          targetCanvas = cs[i];
        }
      }
    }

    // polyfill for webgl1 api
    let ext, gl;
    if (targetCanvas instanceof HTMLCanvasElement) {
      gl = targetCanvas.getContext('webgl') || targetCanvas.getContext('experimental-webgl');
      if (gl) {
        ext = gl.getExtension('EXT_disjoint_timer_query');
        if (ext) {
          gl.createQuery = ext.createQueryEXT.bind(ext);
          gl.deleteQuery = ext.deleteQueryEXT.bind(ext);
          gl.beginQuery = ext.beginQueryEXT.bind(ext);
          gl.endQuery = ext.endQueryEXT.bind(ext);
          gl.getQueryParameter = ext.getQueryObjectEXT.bind(ext);
          gl.QUERY_RESULT_AVAILABLE = ext.QUERY_RESULT_AVAILABLE_EXT;
          gl.QUERY_RESULT = ext.QUERY_RESULT_EXT;
        }
      } else {
        gl = targetCanvas.getContext('webgl2');
        ext = gl ? gl.getExtension('EXT_disjoint_timer_query_webgl2') : null;
      }
    }

    // add default ui on page
    if (this.isDefaultUI) {
      let rootNode = targetCanvas instanceof HTMLCanvasElement ? targetCanvas.parentNode : document.body;
      let domNode = document.getElementById('gl-bench-dom');
      if (!domNode) {
        domNode = document.createElement('div');
        domNode.id = 'gl-bench-dom';
        let styleNode = document.createElement('style');
        styleNode.innerHTML = UIStyle;
        rootNode.appendChild(styleNode);
      }
      let svgNode = document.createElement('template');
      svgNode.innerHTML = ext ? UIFull : UIMin;
      domNode.appendChild(svgNode.content.firstChild);
      rootNode.appendChild(domNode);
    }

    // set default loggers
    if (this.isDefaultLoggers && this.isDefaultUI) {
      function setDomText(id, val) { document.getElementById(id).innerHTML = val; } //<------optimize DOM invoke
      this.loggers.cpuMeasure = (x) => { setDomText('gl-bench-cpu', x.toFixed(0) + '%'); };
      this.loggers.cpuFps = (x) => { setDomText('gl-bench-fps', x.toFixed(0) + ' FPS'); };
      if (ext) {
        this.loggers.gpuMeasure = (x) => { setDomText('gl-bench-gpu', x.toFixed(0) + '%'); };
        this.loggers.gpuFps = (x) => { setDomText('gl-bench-fps', x.toFixed(0) + ' FPS'); };
        this.loggers.cpuFps = () => { };
      }
    }

    // init benchmarks
    this.cpu = new CPU(this.loggers.cpuFps, this.loggers.cpuMeasure);
    this.gpu = (ext) ? new GPU(this.loggers.gpuFps, this.loggers.gpuMeasure, gl, ext) : null;
  }

  /**
   * Begin bottleneck measurement
   */
  begin() {
    if (this.gpu) {
      this.gpu.begin();
      this.cpu.begin();
    } else if (this.cpu) {
      this.cpu.begin();
    } else {
      this.init();
      this.begin();
    }
  }

  /**
   * End bottleneck measurement
   */
  end() {
    if (this.gpu) {
      this.gpu.end();
      this.cpu.end();
    } else if (this.cpu) {
      this.cpu.end();
    }
  }

  /**
   * Nothing interesting here, only fps
   */
  update() {
    this.begin();
    if (this.gpu) {
      this.cpu.fpsLogger = () => {};
    }
  }
}

export default GlBench;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2wtYmVuY2gubW9kdWxlLmpzIiwic291cmNlcyI6WyIuLi9zcmMvZ3B1LmpzIiwiLi4vc3JjL2NwdS5qcyIsIi4uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBHUFUge1xuXG4gIGNvbnN0cnVjdG9yKGZwc0xvZ2dlciwgbWVhc3VyZUxvZ2dlciwgZ2wsIGV4dCkge1xuICAgIHRoaXMuZnBzTG9nZ2VyID0gZnBzTG9nZ2VyO1xuICAgIHRoaXMubWVhc3VyZUxvZ2dlciA9IG1lYXN1cmVMb2dnZXI7XG4gICAgdGhpcy5nbCA9IGdsO1xuICAgIHRoaXMuZXh0ID0gZXh0O1xuXG4gICAgdGhpcy5mcmFtZUlkID0gMDtcbiAgICB0aGlzLmVsYXBzZWRBY2N1bSA9IDA7XG4gICAgdGhpcy5tZWFzdXJlQWNjdW0gPSAwO1xuICAgIHRoaXMucXVldWUgPSBbeyBxdWVyeTogdGhpcy5nbC5jcmVhdGVRdWVyeSgpLCBpc01lYXN1cmU6IGZhbHNlLCBmcmFtZUlkOiB0aGlzLmZyYW1lSWQgfV07XG4gIH1cblxuICBiZWdpbigpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMucXVlcnlJZCA9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5xdWVyeUlkID0gMDtcbiAgICAgIHRoaXMuZ2wuYmVnaW5RdWVyeSh0aGlzLmV4dC5USU1FX0VMQVBTRURfRVhULCB0aGlzLnF1ZXVlWzBdLnF1ZXJ5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5mcmFtZUlkKys7XG4gICAgICB0aGlzLmdsLmVuZFF1ZXJ5KHRoaXMuZXh0LlRJTUVfRUxBUFNFRF9FWFQpO1xuICAgICAgd2hpbGUgKCF0aGlzLmdsLmdldFBhcmFtZXRlcih0aGlzLmV4dC5HUFVfRElTSk9JTlRfRVhUKSAmJiB0aGlzLnF1ZXVlW3RoaXMucXVlcnlJZF0gJiZcbiAgICAgICAgICB0aGlzLmdsLmdldFF1ZXJ5UGFyYW1ldGVyKHRoaXMucXVldWVbdGhpcy5xdWVyeUlkXS5xdWVyeSwgdGhpcy5nbC5RVUVSWV9SRVNVTFRfQVZBSUxBQkxFKSkge1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZHQgPSB0aGlzLmdsLmdldFF1ZXJ5UGFyYW1ldGVyKHRoaXMucXVldWVbdGhpcy5xdWVyeUlkXS5xdWVyeSwgdGhpcy5nbC5RVUVSWV9SRVNVTFQpO1xuICAgICAgICB0aGlzLmVsYXBzZWRBY2N1bSArPSBkdDtcbiAgICAgICAgdGhpcy5tZWFzdXJlQWNjdW0gKz0gdGhpcy5xdWV1ZVt0aGlzLnF1ZXJ5SWRdLmlzTWVhc3VyZSA/IGR0IDogMDtcbiAgICAgICAgbGV0IHNlY29uZHMgPSB0aGlzLmVsYXBzZWRBY2N1bSAvIDFlOTtcblxuICAgICAgICB0aGlzLnF1ZXJ5SWQrKztcbiAgICAgICAgXG4gICAgICAgIGlmIChzZWNvbmRzID49IDEpIHtcbiAgICAgICAgICBjb25zdCBmcHMgPSAodGhpcy5xdWV1ZVt0aGlzLnF1ZXJ5SWQtMV0uZnJhbWVJZCAtIHRoaXMucXVldWVbMF0uZnJhbWVJZCkgLyBzZWNvbmRzO1xuICAgICAgICAgIGNvbnN0IGF2Z01lYXN1cmUgPSAxMDAgKiB0aGlzLm1lYXN1cmVBY2N1bSAvIHRoaXMuZWxhcHNlZEFjY3VtO1xuICAgICAgICAgIHdoaWxlIChzZWNvbmRzID49IDEpIHtcbiAgICAgICAgICAgIHRoaXMuZnBzTG9nZ2VyKGZwcyk7XG4gICAgICAgICAgICB0aGlzLm1lYXN1cmVMb2dnZXIoYXZnTWVhc3VyZSk7XG4gICAgICAgICAgICBzZWNvbmRzLS07XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMucXVldWUuc2xpY2UoMCwgdGhpcy5xdWVyeUlkKS5mb3JFYWNoKHEgPT4gdGhpcy5nbC5kZWxldGVRdWVyeShxLnF1ZXJ5KSk7XG4gICAgICAgICAgdGhpcy5xdWV1ZS5zcGxpY2UoMCwgdGhpcy5xdWVyeUlkKTtcbiAgICAgICAgICB0aGlzLmVsYXBzZWRBY2N1bSA9IDA7XG4gICAgICAgICAgdGhpcy5tZWFzdXJlQWNjdW0gPSAwO1xuICAgICAgICAgIHRoaXMucXVlcnlJZCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5xdWV1ZS5wdXNoKHsgcXVlcnk6IHRoaXMuZ2wuY3JlYXRlUXVlcnkoKSwgaXNNZWFzdXJlOiBmYWxzZSwgZnJhbWVJZDogdGhpcy5mcmFtZUlkIH0pO1xuICAgICAgdGhpcy5nbC5iZWdpblF1ZXJ5KHRoaXMuZXh0LlRJTUVfRUxBUFNFRF9FWFQsIHRoaXMucXVldWVbdGhpcy5xdWV1ZS5sZW5ndGgtMV0ucXVlcnkpO1xuICAgIH1cbiAgfVxuXG4gIGVuZCgpIHtcbiAgICB0aGlzLmdsLmVuZFF1ZXJ5KHRoaXMuZXh0LlRJTUVfRUxBUFNFRF9FWFQpO1xuICAgIHRoaXMucXVldWVbdGhpcy5xdWV1ZS5sZW5ndGgtMV0uaXNNZWFzdXJlID0gdHJ1ZTtcblxuICAgIHRoaXMucXVldWUucHVzaCh7IHF1ZXJ5OiB0aGlzLmdsLmNyZWF0ZVF1ZXJ5KCksIGlzTWVhc3VyZTogZmFsc2UsIGZyYW1lSWQ6IHRoaXMuZnJhbWVJZCB9KTtcbiAgICB0aGlzLmdsLmJlZ2luUXVlcnkodGhpcy5leHQuVElNRV9FTEFQU0VEX0VYVCwgdGhpcy5xdWV1ZVt0aGlzLnF1ZXVlLmxlbmd0aC0xXS5xdWVyeSk7XG4gIH1cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDUFUge1xuXG4gIGNvbnN0cnVjdG9yKGZwc0xvZ2dlciwgbWVhc3VyZUxvZ2dlcikge1xuICAgIHRoaXMuZnBzTG9nZ2VyID0gZnBzTG9nZ2VyO1xuICAgIHRoaXMubWVhc3VyZUxvZ2dlciA9IG1lYXN1cmVMb2dnZXI7XG4gICAgdGhpcy5mcmFtZUNvdW50ID0gMDtcbiAgICB0aGlzLm1lYXN1cmVBY2N1bSA9IDA7XG4gIH1cblxuICBub3coKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgcGVyZm9ybWFuY2UgPT0gJ3VuZGVmaW5lZCcpID8gRGF0ZS5ub3coKSA6IHBlcmZvcm1hbmNlLm5vdygpO1xuICB9XG5cbiAgYmVnaW4oKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLnplcm90aW1lID09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLnplcm90aW1lID0gdGhpcy5ub3coKTtcbiAgICAgIHRoaXMudGltZXN0YW1wID0gdGhpcy56ZXJvdGltZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5mcmFtZUNvdW50Kys7XG4gICAgICB0aGlzLnRpbWVzdGFtcCA9IHRoaXMubm93KCk7XG5cbiAgICAgIGNvbnN0IGVsYXBzZWQgPSB0aGlzLnRpbWVzdGFtcCAtIHRoaXMuemVyb3RpbWU7XG4gICAgICBsZXQgc2Vjb25kcyA9IGVsYXBzZWQgLyAxZTM7XG4gICAgICBpZiAoc2Vjb25kcyA+PSAxKSB7XG4gICAgICAgIGNvbnN0IGZwcyA9IHRoaXMuZnJhbWVDb3VudCAvIHNlY29uZHM7XG4gICAgICAgIGNvbnN0IGF2Z01lYXN1cmUgPSAxMDAgKiB0aGlzLm1lYXN1cmVBY2N1bSAvIGVsYXBzZWQ7XG4gICAgICAgIHdoaWxlIChzZWNvbmRzID49IDEpIHtcbiAgICAgICAgICB0aGlzLmZwc0xvZ2dlcihmcHMpO1xuICAgICAgICAgIHRoaXMubWVhc3VyZUxvZ2dlcihhdmdNZWFzdXJlKTtcbiAgICAgICAgICBzZWNvbmRzLS07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tZWFzdXJlQWNjdW0gPSAwO1xuICAgICAgICB0aGlzLmZyYW1lQ291bnQgPSAwO1xuICAgICAgICB0aGlzLnplcm90aW1lID0gdGhpcy50aW1lc3RhbXA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZW5kKCkge1xuICAgIHRoaXMubWVhc3VyZUFjY3VtICs9IHRoaXMubm93KCkgLSB0aGlzLnRpbWVzdGFtcDtcbiAgfVxufSIsImltcG9ydCBHUFUgZnJvbSAnLi9ncHUuanMnO1xuaW1wb3J0IENQVSBmcm9tICcuL2NwdS5qcyc7XG5cbmltcG9ydCBVSUZ1bGwgZnJvbSAnLi91aS91aS1mdWxsLnN2Zyc7XG5pbXBvcnQgVUlNaW4gZnJvbSAnLi91aS91aS1taW4uc3ZnJztcbmltcG9ydCBVSVN0eWxlIGZyb20gJy4vdWkvdWkuY3NzJztcblxuLyoqXG4qIFdlYkdMLUJlbmNobWFyayBDbGFzc1xuKiBAcGFyYW0geyBCb29sZWFuIHwgdW5kZWZpbmVkIH0gaXNEZWZhdWx0VUlcbiogQHBhcmFtIHsgT2JqZWN0IHwgdW5kZWZpbmVkIH0gc3BlY2lmaWNMb2dnZXJzXG4qL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2xCZW5jaCB7XG4gIGNvbnN0cnVjdG9yKGlzRGVmYXVsdFVJID0gdHJ1ZSwgc3BlY2lmaWNMb2dnZXJzID0gbnVsbCkge1xuICAgIHRoaXMuaXNEZWZhdWx0VUkgPSBpc0RlZmF1bHRVSTtcbiAgICB0aGlzLmlzRGVmYXVsdExvZ2dlcnMgPSAhc3BlY2lmaWNMb2dnZXJzO1xuICAgIHRoaXMubG9nZ2VycyA9IHNwZWNpZmljTG9nZ2VycyA/IHNwZWNpZmljTG9nZ2VycyA6IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cGljaXQgaW5pdGlhbGl6YXRpb25cbiAgICogQHBhcmFtIHsgSFRNTENhbnZhc0VsZW1lbnQgfCB1bmRlZmluZWQgfSB0YXJnZXRDYW52YXMgXG4gICAqL1xuICBpbml0KHRhcmdldENhbnZhcyA9IG51bGwpIHtcblxuICAgIC8vIGNob3NlIGJpZ2dlc3QgY2FudmFzIGlmIG5vdCBzcGVjaWZpZWRcbiAgICBpZiAoIXRhcmdldENhbnZhcykge1xuICAgICAgbGV0IGNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2NhbnZhcycpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaSA9PSAwIHx8IHRhcmdldENhbnZhcy53aWR0aCAqIHRhcmdldENhbnZhcy5oZWlnaHQgPCBjc1tpXS53aWR0aCAqIGNzW2ldLmhlaWdodCkge1xuICAgICAgICAgIHRhcmdldENhbnZhcyA9IGNzW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gcG9seWZpbGwgZm9yIHdlYmdsMSBhcGlcbiAgICBsZXQgZXh0LCBnbDtcbiAgICBpZiAodGFyZ2V0Q2FudmFzIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHtcbiAgICAgIGdsID0gdGFyZ2V0Q2FudmFzLmdldENvbnRleHQoJ3dlYmdsJykgfHwgdGFyZ2V0Q2FudmFzLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcpO1xuICAgICAgaWYgKGdsKSB7XG4gICAgICAgIGV4dCA9IGdsLmdldEV4dGVuc2lvbignRVhUX2Rpc2pvaW50X3RpbWVyX3F1ZXJ5Jyk7XG4gICAgICAgIGlmIChleHQpIHtcbiAgICAgICAgICBnbC5jcmVhdGVRdWVyeSA9IGV4dC5jcmVhdGVRdWVyeUVYVC5iaW5kKGV4dCk7XG4gICAgICAgICAgZ2wuZGVsZXRlUXVlcnkgPSBleHQuZGVsZXRlUXVlcnlFWFQuYmluZChleHQpO1xuICAgICAgICAgIGdsLmJlZ2luUXVlcnkgPSBleHQuYmVnaW5RdWVyeUVYVC5iaW5kKGV4dCk7XG4gICAgICAgICAgZ2wuZW5kUXVlcnkgPSBleHQuZW5kUXVlcnlFWFQuYmluZChleHQpO1xuICAgICAgICAgIGdsLmdldFF1ZXJ5UGFyYW1ldGVyID0gZXh0LmdldFF1ZXJ5T2JqZWN0RVhULmJpbmQoZXh0KTtcbiAgICAgICAgICBnbC5RVUVSWV9SRVNVTFRfQVZBSUxBQkxFID0gZXh0LlFVRVJZX1JFU1VMVF9BVkFJTEFCTEVfRVhUO1xuICAgICAgICAgIGdsLlFVRVJZX1JFU1VMVCA9IGV4dC5RVUVSWV9SRVNVTFRfRVhUO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbCA9IHRhcmdldENhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbDInKTtcbiAgICAgICAgZXh0ID0gZ2wgPyBnbC5nZXRFeHRlbnNpb24oJ0VYVF9kaXNqb2ludF90aW1lcl9xdWVyeV93ZWJnbDInKSA6IG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gYWRkIGRlZmF1bHQgdWkgb24gcGFnZVxuICAgIGlmICh0aGlzLmlzRGVmYXVsdFVJKSB7XG4gICAgICBsZXQgcm9vdE5vZGUgPSB0YXJnZXRDYW52YXMgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCA/IHRhcmdldENhbnZhcy5wYXJlbnROb2RlIDogZG9jdW1lbnQuYm9keTtcbiAgICAgIGxldCBkb21Ob2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsLWJlbmNoLWRvbScpO1xuICAgICAgaWYgKCFkb21Ob2RlKSB7XG4gICAgICAgIGRvbU5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZG9tTm9kZS5pZCA9ICdnbC1iZW5jaC1kb20nO1xuICAgICAgICBsZXQgc3R5bGVOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICAgICAgc3R5bGVOb2RlLmlubmVySFRNTCA9IFVJU3R5bGU7XG4gICAgICAgIHJvb3ROb2RlLmFwcGVuZENoaWxkKHN0eWxlTm9kZSk7XG4gICAgICB9XG4gICAgICBsZXQgc3ZnTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7XG4gICAgICBzdmdOb2RlLmlubmVySFRNTCA9IGV4dCA/IFVJRnVsbCA6IFVJTWluO1xuICAgICAgZG9tTm9kZS5hcHBlbmRDaGlsZChzdmdOb2RlLmNvbnRlbnQuZmlyc3RDaGlsZCk7XG4gICAgICByb290Tm9kZS5hcHBlbmRDaGlsZChkb21Ob2RlKTtcbiAgICB9XG5cbiAgICAvLyBzZXQgZGVmYXVsdCBsb2dnZXJzXG4gICAgaWYgKHRoaXMuaXNEZWZhdWx0TG9nZ2VycyAmJiB0aGlzLmlzRGVmYXVsdFVJKSB7XG4gICAgICBmdW5jdGlvbiBzZXREb21UZXh0KGlkLCB2YWwpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmlubmVySFRNTCA9IHZhbDsgfSAvLzwtLS0tLS1vcHRpbWl6ZSBET00gaW52b2tlXG4gICAgICB0aGlzLmxvZ2dlcnMuY3B1TWVhc3VyZSA9ICh4KSA9PiB7IHNldERvbVRleHQoJ2dsLWJlbmNoLWNwdScsIHgudG9GaXhlZCgwKSArICclJykgfTtcbiAgICAgIHRoaXMubG9nZ2Vycy5jcHVGcHMgPSAoeCkgPT4geyBzZXREb21UZXh0KCdnbC1iZW5jaC1mcHMnLCB4LnRvRml4ZWQoMCkgKyAnIEZQUycpIH07XG4gICAgICBpZiAoZXh0KSB7XG4gICAgICAgIHRoaXMubG9nZ2Vycy5ncHVNZWFzdXJlID0gKHgpID0+IHsgc2V0RG9tVGV4dCgnZ2wtYmVuY2gtZ3B1JywgeC50b0ZpeGVkKDApICsgJyUnKSB9O1xuICAgICAgICB0aGlzLmxvZ2dlcnMuZ3B1RnBzID0gKHgpID0+IHsgc2V0RG9tVGV4dCgnZ2wtYmVuY2gtZnBzJywgeC50b0ZpeGVkKDApICsgJyBGUFMnKSB9O1xuICAgICAgICB0aGlzLmxvZ2dlcnMuY3B1RnBzID0gKCkgPT4geyB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGluaXQgYmVuY2htYXJrc1xuICAgIHRoaXMuY3B1ID0gbmV3IENQVSh0aGlzLmxvZ2dlcnMuY3B1RnBzLCB0aGlzLmxvZ2dlcnMuY3B1TWVhc3VyZSk7XG4gICAgdGhpcy5ncHUgPSAoZXh0KSA/IG5ldyBHUFUodGhpcy5sb2dnZXJzLmdwdUZwcywgdGhpcy5sb2dnZXJzLmdwdU1lYXN1cmUsIGdsLCBleHQpIDogbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCZWdpbiBib3R0bGVuZWNrIG1lYXN1cmVtZW50XG4gICAqL1xuICBiZWdpbigpIHtcbiAgICBpZiAodGhpcy5ncHUpIHtcbiAgICAgIHRoaXMuZ3B1LmJlZ2luKCk7XG4gICAgICB0aGlzLmNwdS5iZWdpbigpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jcHUpIHtcbiAgICAgIHRoaXMuY3B1LmJlZ2luKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgdGhpcy5iZWdpbigpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmQgYm90dGxlbmVjayBtZWFzdXJlbWVudFxuICAgKi9cbiAgZW5kKCkge1xuICAgIGlmICh0aGlzLmdwdSkge1xuICAgICAgdGhpcy5ncHUuZW5kKCk7XG4gICAgICB0aGlzLmNwdS5lbmQoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY3B1KSB7XG4gICAgICB0aGlzLmNwdS5lbmQoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTm90aGluZyBpbnRlcmVzdGluZyBoZXJlLCBvbmx5IGZwc1xuICAgKi9cbiAgdXBkYXRlKCkge1xuICAgIHRoaXMuYmVnaW4oKTtcbiAgICBpZiAodGhpcy5ncHUpIHtcbiAgICAgIHRoaXMuY3B1LmZwc0xvZ2dlciA9ICgpID0+IHt9O1xuICAgIH1cbiAgfVxufSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBZSxNQUFNLEdBQUcsQ0FBQzs7RUFFdkIsV0FBVyxDQUFDLFNBQVMsRUFBRSxhQUFhLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRTtJQUM3QyxJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztJQUMzQixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztJQUNuQyxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztJQUNiLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDOztJQUVmLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO0lBQ2pCLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0dBQzFGOztFQUVELEtBQUssR0FBRztJQUNOLElBQUksT0FBTyxJQUFJLENBQUMsT0FBTyxJQUFJLFdBQVcsRUFBRTtNQUN0QyxJQUFJLENBQUMsT0FBTyxHQUFH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
