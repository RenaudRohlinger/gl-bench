class GPU {

  constructor(gl, ext, fpsLogger, gpuLogger) {
    this.fpsLogger = fpsLogger ? fpsLogger : () => {};
    this.gpuLogger = gpuLogger ? gpuLogger : () => {};

    this.frameId = 0;
    this.namedAccums = [];
    this.measureMode = 0;

    this.queryId = 0;
    this.queryQueue = [];
    this.totalAccum = 0;

    // unify webgl & webgl2 api
    if (ext && ext.constructor.name == 'EXTDisjointTimerQuery') {
      gl.createQuery = ext.createQueryEXT.bind(ext);
      gl.deleteQuery = ext.deleteQueryEXT.bind(ext);
      gl.beginQuery = ext.beginQueryEXT.bind(ext);
      gl.endQuery = ext.endQueryEXT.bind(ext);
      gl.getQueryParameter = ext.getQueryObjectEXT.bind(ext);
      gl.QUERY_RESULT_AVAILABLE = ext.QUERY_RESULT_AVAILABLE_EXT;
      gl.QUERY_RESULT = ext.QUERY_RESULT_EXT;
    }
    this.gl = gl;
    this.ext = ext;
  }

  begin(nameId) {
    if (nameId === 0) this.frameId++;
    if (this.namedAccums.length <= nameId) this.namedAccums.push(0);
    
    if (this.queryQueue.length > 0) {
      this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);
      while (!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT) && this.queryQueue[this.queryId] &&
            this.gl.getQueryParameter(this.queryQueue[this.queryId].query, this.gl.QUERY_RESULT_AVAILABLE)) {
              
        const dt = this.gl.getQueryParameter(this.queryQueue[this.queryId].query, this.gl.QUERY_RESULT);
        this.totalAccum += dt;
        const binaryFlags = this.queryQueue[this.queryId].measureMode.toString(2);
        for (let i = 0; i < binaryFlags.length; i++) {
          if (binaryFlags[i] == '1') this.namedAccums[binaryFlags.length - i - 1] += dt;
        }

        this.queryId++;
        let seconds = this.totalAccum / 1e9;
        if (seconds >= 1) {
          const frames = this.queryQueue[this.queryId-1].frameId - this.queryQueue[0].frameId;
          const fps = frames / seconds;
          const frametime = this.totalAccum / frames / 1e6;
          for (let i = 0; i < this.namedAccums.length; i++) {
            const accum = this.namedAccums[i];
            const gpu = accum / this.totalAccum * 100;
            const ms = accum / frames / 1e6;
            this.fpsLogger(fps, frametime, i);
            this.gpuLogger(gpu, ms, i);
          }
          this.queryQueue.slice(0, this.queryId).forEach(q => this.gl.deleteQuery(q.query));
          this.queryQueue.splice(0, this.queryId);
          let i = this.namedAccums.length;
          while (i--) this.namedAccums[i] = 0;
          this.totalAccum = 0;
          this.queryId = 0;
        }
      }
    }
    
    this.measureMode += 1 << nameId;
    this.queryQueue.push({ query: this.gl.createQuery(), measureMode: this.measureMode, frameId: this.frameId });
    this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT, this.queryQueue[this.queryQueue.length-1].query);
  }

  end(nameId) {
    this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);
    this.measureMode -= 1 << nameId;

    this.queryQueue.push({ query: this.gl.createQuery(), measureMode: this.measureMode, frameId: this.frameId });
    this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT, this.queryQueue[this.queryQueue.length-1].query);
  }
}

class CPU {

  constructor(fpsLogger, cpuLogger) {
    this.fpsLogger = fpsLogger ? fpsLogger : () => {};
    this.cpuLogger = cpuLogger ? cpuLogger : () => {};

    this.frameId = 0;
    this.namedAccums = [];
    this.measureMode = 0;

    this.zerotime = null;
    this.namedBegins = [];
  }

  now() {
    return (performance && performance.now) ? performance.now() : Date.now();
  }

  begin(nameId) {
    if (nameId === 0) this.frameId++;
    if (this.namedAccums.length <= nameId) this.namedAccums.push(0);
    if (this.namedBegins.length <= nameId) this.namedBegins.push(0);

    this.namedBegins[nameId] = this.now();
    if (this.zerotime == null) {
      this.zerotime = this.namedBegins[nameId];
    } else {
      const totalAccum = this.namedBegins[nameId] - this.zerotime;
      let seconds = totalAccum / 1e3;
      if (seconds >= 1) {
        const fps = this.frameId / seconds;
        const frametime = totalAccum / this.frameId;
        for (let i = 0; i < this.namedAccums.length; i++) {
          const accum = this.namedAccums[i];
          const cpu = accum / totalAccum * 100;
          const ms = accum / this.frameId;
          this.fpsLogger(fps, frametime, i);
          this.cpuLogger(cpu, ms, i);
        }
        let j = this.namedAccums.length;
        while (j--) this.namedAccums[j] = 0;
        this.frameId = 0;
        this.zerotime = this.namedBegins[nameId];
      }
    }
    this.measureMode += 1 << nameId;
  }

  end(nameId) {
    const dt = this.now() - this.namedBegins[nameId];
    const binaryFlags = this.measureMode.toString(2);
    for (let i = 0; i < binaryFlags.length; i++) {
      if (binaryFlags[i] == '1') this.namedAccums[binaryFlags.length - i - 1] += dt;
    }
    this.measureMode -= 1 << nameId;
  }
}

var UIFull = "<svg viewBox=\"0 0 100 70\" class=\"gl-bench\">\n\n<rect x=\"0\" y=\"0\" width=\"100\" height=\"70\" rx=\"26.5\" ry=\"26.5\" class=\"gl-box\"/>\n\n<text x=\"26.5\" y=\"22\" class=\"gl-text gl-cpu\">00%</text>\n<text x=\"26.5\" y=\"34\" class=\"gl-text\">CPU</text>\n<circle cx=\"26.5\" cy=\"26.5\" r=\"20\" stroke-width=\"3.5\" class=\"gl-circle\"/>\n<path d=\"M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831\"\n  class=\"gl-arc gl-cpu-arc\"/>\n\n<circle cx=\"73.5\" cy=\"26.5\" r=\"20\" stroke-width=\"3.5\" class=\"gl-circle\"/>\n<text x=\"73.5\" y=\"22\" class=\"gl-text gl-gpu\">00%</text>\n<text x=\"73.5\" y=\"34\" class=\"gl-text\">GPU</text>\n<path d=\"M58.5 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831\"\n  class=\"gl-arc gl-gpu-arc\"/>\n\n<text x=\"50\" y=\"59\" font-size=\".8em\" class=\"gl-text gl-fps\">00 FPS</text>\n<circle cx=\"18\" cy=\"58\" r=\"3\" style=\"opacity:0.55\"/>\n<circle cx=\"82\" cy=\"58\" r=\"3\" style=\"opacity:0.55\"/>\n\n</svg>";

var UIMin = "<svg viewBox=\"0 0 100 52.632\" class=\"gl-bench\">\n\n<rect x=\"0\" y=\"0\" width=\"100\" height=\"52.632\" rx=\"26.5\" ry=\"26.5\" class=\"gl-box\"/>\n\n<text x=\"26.5\" y=\"22\" class=\"gl-text gl-cpu\">00%</text>\n<text x=\"26.5\" y=\"34\" class=\"gl-text\">CPU</text>\n<circle cx=\"26.5\" cy=\"26.5\" r=\"20\" stroke-width=\"3.5\" class=\"gl-circle\"/>\n<path d=\"M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831\"\n  stroke-dasharray=\"0, 100\" class=\"gl-arc gl-cpu-arc\"/>\n\n<text x=\"74\" y=\"28\" font-size=\"0.8em\" class=\"gl-text gl-fps\">00 FPS</text>\n\n</svg>";

var UIStyle = ".gl-bench {\n  position: relative;\n  display: block;\n  margin: 5px;\n  width: 100px;\n  cursor: pointer;\n}\n\n.gl-box {\n  fill: hsla(120, 50%, 60%, 0.65);\n}\n\n.gl-text {\n  font-family: sans-serif;\n  font-weight: 700;\n  font-size: 0.7em;\n  dominant-baseline: middle;\n  text-anchor: middle;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  opacity: 0.7;\n}\n\n.gl-arc {\n  fill: none;  \n  stroke: black;\n  stroke-width: 2.6;\n  opacity: 0.5;  \n  transform: scale(1.25663);\n  stroke-dasharray: 0, 100;\n}\n\n.gl-circle {\n  fill: none;\n  stroke: black;\n  opacity: 0.4;\n}";

/**
* WebGL benchmark
* @param { Object | undefined } extraLoggers
*/
class GLBench {
  constructor(extraLoggers = {}) {
    Object.assign(this, extraLoggers);
    this.showMS = false;
    this.names = [];
  }

  /**
   * Context and UI initialization
   * @param { WebGLRenderingContext | WebGL2RenderingContext } webglContext 
   * @param { number | undefined } uiCount
   */
  init(webglContext, uiCount = 1) {
    let ext;
    if (webglContext instanceof WebGLRenderingContext) {
      ext = webglContext.getExtension('EXT_disjoint_timer_query');
    } else if (webglContext instanceof WebGL2RenderingContext) {
      ext = webglContext.getExtension('EXT_disjoint_timer_query_webgl2');
    }

    if (uiCount > 0) {
      const rootNode = document.body;
      let domNode = document.getElementById('gl-bench-dom');
      if (!domNode) {
        domNode = document.createElement('div');
        domNode.id = 'gl-bench-dom';
        domNode.style.cssText = 'position:absolute;left:0;top:0;z-index:1000';
        let styleNode = document.createElement('style');
        styleNode.innerHTML = UIStyle;
        domNode.appendChild(styleNode);
      }
      let svgNode = document.createElement('template');
      svgNode.innerHTML = ext ? UIFull : UIMin;
      svgNode = svgNode.content.firstChild;
      domNode.addEventListener('click', () => { this.showMS = !this.showMS; });
      while (uiCount--) domNode.appendChild(svgNode.cloneNode(true));
      rootNode.appendChild(domNode);

      function loggerTemplate(extraLogger, elm, elmChanger, pct, pctChanger) {
        this.elm = domNode.getElementsByClassName(elm);
        this.pct = domNode.getElementsByClassName(pct);
        return (x, y, i) => {
          this.elm[i].innerHTML = elmChanger(x, y);
          this.pct[i].style[pct == 'gl-box' ? 'fill' : 'strokeDasharray'] = pctChanger(x);
          if (extraLogger) extraLogger(x);
        }
      }
      this.fpsLogger = loggerTemplate.bind({}) (this.fpsLogger,
        'gl-fps', (fps, ms) => !this.showMS ? fps.toFixed(0) + ' FPS' : ms.toFixed(2) + ' MS',
        'gl-box', fps => 'hsla(' + Math.min(120, Math.max(0, 2.182*(fps-5))) + ',50%,60%,0.65)'
      );
      this.cpuLogger = loggerTemplate.bind({}) (this.cpuLogger,
        'gl-cpu', (cpu, ms) => !this.showMS ? cpu.toFixed(0) + '%' : ms.toFixed(2),
        'gl-cpu-arc', cpu => cpu.toFixed(0) + ', 100'
      );
      this.gpuLogger = !ext ? null : loggerTemplate.bind({}) (this.gpuLogger,
        'gl-gpu', (gpu, ms) => !this.showMS ? gpu.toFixed(0) + '%' : ms.toFixed(2),
        'gl-gpu-arc', gpu => gpu.toFixed(0) + ', 100'
      );
    }

    if (!ext) {
      this.cpu = new CPU(this.fpsLogger, this.cpuLogger);
    } else {
      this.cpu = new CPU(null, this.cpuLogger);
      this.gpu = new GPU(webglContext, ext, this.fpsLogger, this.gpuLogger);
    }
  }

  /**
   * Begin named measure
   * @param { string | undefined } name
   */
  begin(name) {
    let nameId = this.names.indexOf(name);
    if (this.names.indexOf(name) == -1) {
      nameId = this.names.length;
      this.names.push(name);
    }

    this.cpu.begin(nameId);
    if (this.gpu) this.gpu.begin(nameId);
  }

  /**
   * End named measure
   * @param { string | undefined } name
   */
  end(name) {
    const nameId = this.names.indexOf(name);
    this.cpu.end(nameId);
    if (this.gpu) this.gpu.end(nameId);
  }

  /**
   * Probably should be removed
   */
  update() {
    if (!this.firstUpdate) this.firstUpdate = true;
    else this.end();
    this.begin();
  }
}

export default GLBench;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2wtYmVuY2gubW9kdWxlLmpzIiwic291cmNlcyI6WyIuLi9zcmMvZ3B1LmpzIiwiLi4vc3JjL2NwdS5qcyIsIi4uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBHUFUge1xuXG4gIGNvbnN0cnVjdG9yKGdsLCBleHQsIGZwc0xvZ2dlciwgZ3B1TG9nZ2VyKSB7XG4gICAgdGhpcy5mcHNMb2dnZXIgPSBmcHNMb2dnZXIgPyBmcHNMb2dnZXIgOiAoKSA9PiB7fTtcbiAgICB0aGlzLmdwdUxvZ2dlciA9IGdwdUxvZ2dlciA/IGdwdUxvZ2dlciA6ICgpID0+IHt9O1xuXG4gICAgdGhpcy5mcmFtZUlkID0gMDtcbiAgICB0aGlzLm5hbWVkQWNjdW1zID0gW107XG4gICAgdGhpcy5tZWFzdXJlTW9kZSA9IDA7XG5cbiAgICB0aGlzLnF1ZXJ5SWQgPSAwO1xuICAgIHRoaXMucXVlcnlRdWV1ZSA9IFtdO1xuICAgIHRoaXMudG90YWxBY2N1bSA9IDA7XG5cbiAgICAvLyB1bmlmeSB3ZWJnbCAmIHdlYmdsMiBhcGlcbiAgICBpZiAoZXh0ICYmIGV4dC5jb25zdHJ1Y3Rvci5uYW1lID09ICdFWFREaXNqb2ludFRpbWVyUXVlcnknKSB7XG4gICAgICBnbC5jcmVhdGVRdWVyeSA9IGV4dC5jcmVhdGVRdWVyeUVYVC5iaW5kKGV4dCk7XG4gICAgICBnbC5kZWxldGVRdWVyeSA9IGV4dC5kZWxldGVRdWVyeUVYVC5iaW5kKGV4dCk7XG4gICAgICBnbC5iZWdpblF1ZXJ5ID0gZXh0LmJlZ2luUXVlcnlFWFQuYmluZChleHQpO1xuICAgICAgZ2wuZW5kUXVlcnkgPSBleHQuZW5kUXVlcnlFWFQuYmluZChleHQpO1xuICAgICAgZ2wuZ2V0UXVlcnlQYXJhbWV0ZXIgPSBleHQuZ2V0UXVlcnlPYmplY3RFWFQuYmluZChleHQpO1xuICAgICAgZ2wuUVVFUllfUkVTVUxUX0FWQUlMQUJMRSA9IGV4dC5RVUVSWV9SRVNVTFRfQVZBSUxBQkxFX0VYVDtcbiAgICAgIGdsLlFVRVJZX1JFU1VMVCA9IGV4dC5RVUVSWV9SRVNVTFRfRVhUO1xuICAgIH1cbiAgICB0aGlzLmdsID0gZ2w7XG4gICAgdGhpcy5leHQgPSBleHQ7XG4gIH1cblxuICBiZWdpbihuYW1lSWQpIHtcbiAgICBpZiAobmFtZUlkID09PSAwKSB0aGlzLmZyYW1lSWQrKztcbiAgICBpZiAodGhpcy5uYW1lZEFjY3Vtcy5sZW5ndGggPD0gbmFtZUlkKSB0aGlzLm5hbWVkQWNjdW1zLnB1c2goMCk7XG4gICAgXG4gICAgaWYgKHRoaXMucXVlcnlRdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmdsLmVuZFF1ZXJ5KHRoaXMuZXh0LlRJTUVfRUxBUFNFRF9FWFQpO1xuICAgICAgd2hpbGUgKCF0aGlzLmdsLmdldFBhcmFtZXRlcih0aGlzLmV4dC5HUFVfRElTSk9JTlRfRVhUKSAmJiB0aGlzLnF1ZXJ5UXVldWVbdGhpcy5xdWVyeUlkXSAmJlxuICAgICAgICAgICAgdGhpcy5nbC5nZXRRdWVyeVBhcmFtZXRlcih0aGlzLnF1ZXJ5UXVldWVbdGhpcy5xdWVyeUlkXS5xdWVyeSwgdGhpcy5nbC5RVUVSWV9SRVNVTFRfQVZBSUxBQkxFKSkge1xuICAgICAgICAgICAgICBcbiAgICAgICAgY29uc3QgZHQgPSB0aGlzLmdsLmdldFF1ZXJ5UGFyYW1ldGVyKHRoaXMucXVlcnlRdWV1ZVt0aGlzLnF1ZXJ5SWRdLnF1ZXJ5LCB0aGlzLmdsLlFVRVJZX1JFU1VMVCk7XG4gICAgICAgIHRoaXMudG90YWxBY2N1bSArPSBkdDtcbiAgICAgICAgY29uc3QgYmluYXJ5RmxhZ3MgPSB0aGlzLnF1ZXJ5UXVldWVbdGhpcy5xdWVyeUlkXS5tZWFzdXJlTW9kZS50b1N0cmluZygyKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnlGbGFncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChiaW5hcnlGbGFnc1tpXSA9PSAnMScpIHRoaXMubmFtZWRBY2N1bXNbYmluYXJ5RmxhZ3MubGVuZ3RoIC0gaSAtIDFdICs9IGR0O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5xdWVyeUlkKys7XG4gICAgICAgIGxldCBzZWNvbmRzID0gdGhpcy50b3RhbEFjY3VtIC8gMWU5O1xuICAgICAgICBpZiAoc2Vjb25kcyA+PSAxKSB7XG4gICAgICAgICAgY29uc3QgZnJhbWVzID0gdGhpcy5xdWVyeVF1ZXVlW3RoaXMucXVlcnlJZC0xXS5mcmFtZUlkIC0gdGhpcy5xdWVyeVF1ZXVlWzBdLmZyYW1lSWQ7XG4gICAgICAgICAgY29uc3QgZnBzID0gZnJhbWVzIC8gc2Vjb25kcztcbiAgICAgICAgICBjb25zdCBmcmFtZXRpbWUgPSB0aGlzLnRvdGFsQWNjdW0gLyBmcmFtZXMgLyAxZTY7XG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm5hbWVkQWNjdW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBhY2N1bSA9IHRoaXMubmFtZWRBY2N1bXNbaV07XG4gICAgICAgICAgICBjb25zdCBncHUgPSBhY2N1bSAvIHRoaXMudG90YWxBY2N1bSAqIDEwMDtcbiAgICAgICAgICAgIGNvbnN0IG1zID0gYWNjdW0gLyBmcmFtZXMgLyAxZTY7XG4gICAgICAgICAgICB0aGlzLmZwc0xvZ2dlcihmcHMsIGZyYW1ldGltZSwgaSk7XG4gICAgICAgICAgICB0aGlzLmdwdUxvZ2dlcihncHUsIG1zLCBpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5xdWVyeVF1ZXVlLnNsaWNlKDAsIHRoaXMucXVlcnlJZCkuZm9yRWFjaChxID0+IHRoaXMuZ2wuZGVsZXRlUXVlcnkocS5xdWVyeSkpO1xuICAgICAgICAgIHRoaXMucXVlcnlRdWV1ZS5zcGxpY2UoMCwgdGhpcy5xdWVyeUlkKTtcbiAgICAgICAgICBsZXQgaSA9IHRoaXMubmFtZWRBY2N1bXMubGVuZ3RoO1xuICAgICAgICAgIHdoaWxlIChpLS0pIHRoaXMubmFtZWRBY2N1bXNbaV0gPSAwO1xuICAgICAgICAgIHRoaXMudG90YWxBY2N1bSA9IDA7XG4gICAgICAgICAgdGhpcy5xdWVyeUlkID0gMDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICB0aGlzLm1lYXN1cmVNb2RlICs9IDEgPDwgbmFtZUlkO1xuICAgIHRoaXMucXVlcnlRdWV1ZS5wdXNoKHsgcXVlcnk6IHRoaXMuZ2wuY3JlYXRlUXVlcnkoKSwgbWVhc3VyZU1vZGU6IHRoaXMubWVhc3VyZU1vZGUsIGZyYW1lSWQ6IHRoaXMuZnJhbWVJZCB9KTtcbiAgICB0aGlzLmdsLmJlZ2luUXVlcnkodGhpcy5leHQuVElNRV9FTEFQU0VEX0VYVCwgdGhpcy5xdWVyeVF1ZXVlW3RoaXMucXVlcnlRdWV1ZS5sZW5ndGgtMV0ucXVlcnkpO1xuICB9XG5cbiAgZW5kKG5hbWVJZCkge1xuICAgIHRoaXMuZ2wuZW5kUXVlcnkodGhpcy5leHQuVElNRV9FTEFQU0VEX0VYVCk7XG4gICAgdGhpcy5tZWFzdXJlTW9kZSAtPSAxIDw8IG5hbWVJZDtcblxuICAgIHRoaXMucXVlcnlRdWV1ZS5wdXNoKHsgcXVlcnk6IHRoaXMuZ2wuY3JlYXRlUXVlcnkoKSwgbWVhc3VyZU1vZGU6IHRoaXMubWVhc3VyZU1vZGUsIGZyYW1lSWQ6IHRoaXMuZnJhbWVJZCB9KTtcbiAgICB0aGlzLmdsLmJlZ2luUXVlcnkodGhpcy5leHQuVElNRV9FTEFQU0VEX0VYVCwgdGhpcy5xdWVyeVF1ZXVlW3RoaXMucXVlcnlRdWV1ZS5sZW5ndGgtMV0ucXVlcnkpO1xuICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ1BVIHtcblxuICBjb25zdHJ1Y3RvcihmcHNMb2dnZXIsIGNwdUxvZ2dlcikge1xuICAgIHRoaXMuZnBzTG9nZ2VyID0gZnBzTG9nZ2VyID8gZnBzTG9nZ2VyIDogKCkgPT4ge307XG4gICAgdGhpcy5jcHVMb2dnZXIgPSBjcHVMb2dnZXIgPyBjcHVMb2dnZXIgOiAoKSA9PiB7fTtcblxuICAgIHRoaXMuZnJhbWVJZCA9IDA7XG4gICAgdGhpcy5uYW1lZEFjY3VtcyA9IFtdO1xuICAgIHRoaXMubWVhc3VyZU1vZGUgPSAwO1xuXG4gICAgdGhpcy56ZXJvdGltZSA9IG51bGw7XG4gICAgdGhpcy5uYW1lZEJlZ2lucyA9IFtdO1xuICB9XG5cbiAgbm93KCkge1xuICAgIHJldHVybiAocGVyZm9ybWFuY2UgJiYgcGVyZm9ybWFuY2Uubm93KSA/IHBlcmZvcm1hbmNlLm5vdygpIDogRGF0ZS5ub3coKTtcbiAgfVxuXG4gIGJlZ2luKG5hbWVJZCkge1xuICAgIGlmIChuYW1lSWQgPT09IDApIHRoaXMuZnJhbWVJZCsrO1xuICAgIGlmICh0aGlzLm5hbWVkQWNjdW1zLmxlbmd0aCA8PSBuYW1lSWQpIHRoaXMubmFtZWRBY2N1bXMucHVzaCgwKTtcbiAgICBpZiAodGhpcy5uYW1lZEJlZ2lucy5sZW5ndGggPD0gbmFtZUlkKSB0aGlzLm5hbWVkQmVnaW5zLnB1c2goMCk7XG5cbiAgICB0aGlzLm5hbWVkQmVnaW5zW25hbWVJZF0gPSB0aGlzLm5vdygpO1xuICAgIGlmICh0aGlzLnplcm90aW1lID09IG51bGwpIHtcbiAgICAgIHRoaXMuemVyb3RpbWUgPSB0aGlzLm5hbWVkQmVnaW5zW25hbWVJZF07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRvdGFsQWNjdW0gPSB0aGlzLm5hbWVkQmVnaW5zW25hbWVJZF0gLSB0aGlzLnplcm90aW1lO1xuICAgICAgbGV0IHNlY29uZHMgPSB0b3RhbEFjY3VtIC8gMWUzO1xuICAgICAgaWYgKHNlY29uZHMgPj0gMSkge1xuICAgICAgICBjb25zdCBmcHMgPSB0aGlzLmZyYW1lSWQgLyBzZWNvbmRzO1xuICAgICAgICBjb25zdCBmcmFtZXRpbWUgPSB0b3RhbEFjY3VtIC8gdGhpcy5mcmFtZUlkO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubmFtZWRBY2N1bXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBhY2N1bSA9IHRoaXMubmFtZWRBY2N1bXNbaV07XG4gICAgICAgICAgY29uc3QgY3B1ID0gYWNjdW0gLyB0b3RhbEFjY3VtICogMTAwO1xuICAgICAgICAgIGNvbnN0IG1zID0gYWNjdW0gLyB0aGlzLmZyYW1lSWQ7XG4gICAgICAgICAgdGhpcy5mcHNMb2dnZXIoZnBzLCBmcmFtZXRpbWUsIGkpO1xuICAgICAgICAgIHRoaXMuY3B1TG9nZ2VyKGNwdSwgbXMsIGkpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBqID0gdGhpcy5uYW1lZEFjY3Vtcy5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChqLS0pIHRoaXMubmFtZWRBY2N1bXNbal0gPSAwO1xuICAgICAgICB0aGlzLmZyYW1lSWQgPSAwO1xuICAgICAgICB0aGlzLnplcm90aW1lID0gdGhpcy5uYW1lZEJlZ2luc1tuYW1lSWRdO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm1lYXN1cmVNb2RlICs9IDEgPDwgbmFtZUlkO1xuICB9XG5cbiAgZW5kKG5hbWVJZCkge1xuICAgIGNvbnN0IGR0ID0gdGhpcy5ub3coKSAtIHRoaXMubmFtZWRCZWdpbnNbbmFtZUlkXTtcbiAgICBjb25zdCBiaW5hcnlGbGFncyA9IHRoaXMubWVhc3VyZU1vZGUudG9TdHJpbmcoMik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnlGbGFncy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGJpbmFyeUZsYWdzW2ldID09ICcxJykgdGhpcy5uYW1lZEFjY3Vtc1tiaW5hcnlGbGFncy5sZW5ndGggLSBpIC0gMV0gKz0gZHQ7XG4gICAgfVxuICAgIHRoaXMubWVhc3VyZU1vZGUgLT0gMSA8PCBuYW1lSWQ7XG4gIH1cbn0iLCJpbXBvcnQgR1BVIGZyb20gJy4vZ3B1LmpzJztcbmltcG9ydCBDUFUgZnJvbSAnLi9jcHUuanMnO1xuXG5pbXBvcnQgVUlGdWxsIGZyb20gJy4vdWkvdWktZnVsbC5zdmcnO1xuaW1wb3J0IFVJTWluIGZyb20gJy4vdWkvdWktbWluLnN2Zyc7XG5pbXBvcnQgVUlTdHlsZSBmcm9tICcuL3VpL3VpLmNzcyc7XG5cbi8qKlxuKiBXZWJHTCBiZW5jaG1hcmtcbiogQHBhcmFtIHsgT2JqZWN0IHwgdW5kZWZpbmVkIH0gZXh0cmFMb2dnZXJzXG4qL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR0xCZW5jaCB7XG4gIGNvbnN0cnVjdG9yKGV4dHJhTG9nZ2VycyA9IHt9KSB7XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLCBleHRyYUxvZ2dlcnMpO1xuICAgIHRoaXMuc2hvd01TID0gZmFsc2U7XG4gICAgdGhpcy5uYW1lcyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnRleHQgYW5kIFVJIGluaXRpYWxpemF0aW9uXG4gICAqIEBwYXJhbSB7IFdlYkdMUmVuZGVyaW5nQ29udGV4dCB8IFdlYkdMMlJlbmRlcmluZ0NvbnRleHQgfSB3ZWJnbENvbnRleHQgXG4gICAqIEBwYXJhbSB7IG51bWJlciB8IHVuZGVmaW5lZCB9IHVpQ291bnRcbiAgICovXG4gIGluaXQod2ViZ2xDb250ZXh0LCB1aUNvdW50ID0gMSkge1xuICAgIGxldCBleHQ7XG4gICAgaWYgKHdlYmdsQ29udGV4dCBpbnN0YW5jZW9mIFdlYkdMUmVuZGVyaW5nQ29udGV4dCkge1xuICAgICAgZXh0ID0gd2ViZ2xDb250ZXh0LmdldEV4dGVuc2lvbignRVhUX2Rpc2pvaW50X3RpbWVyX3F1ZXJ5Jyk7XG4gICAgfSBlbHNlIGlmICh3ZWJnbENvbnRleHQgaW5zdGFuY2VvZiBXZWJHTDJSZW5kZXJpbmdDb250ZXh0KSB7XG4gICAgICBleHQgPSB3ZWJnbENvbnRleHQuZ2V0RXh0ZW5zaW9uKCdFWFRfZGlzam9pbnRfdGltZXJfcXVlcnlfd2ViZ2wyJyk7XG4gICAgfVxuXG4gICAgaWYgKHVpQ291bnQgPiAwKSB7XG4gICAgICBjb25zdCByb290Tm9kZSA9IGRvY3VtZW50LmJvZHk7XG4gICAgICBsZXQgZG9tTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnbC1iZW5jaC1kb20nKTtcbiAgICAgIGlmICghZG9tTm9kZSkge1xuICAgICAgICBkb21Ob2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGRvbU5vZGUuaWQgPSAnZ2wtYmVuY2gtZG9tJztcbiAgICAgICAgZG9tTm9kZS5zdHlsZS5jc3NUZXh0ID0gJ3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDt6LWluZGV4OjEwMDAnO1xuICAgICAgICBsZXQgc3R5bGVOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICAgICAgc3R5bGVOb2RlLmlubmVySFRNTCA9IFVJU3R5bGU7XG4gICAgICAgIGRvbU5vZGUuYXBwZW5kQ2hpbGQoc3R5bGVOb2RlKTtcbiAgICAgIH1cbiAgICAgIGxldCBzdmdOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKTtcbiAgICAgIHN2Z05vZGUuaW5uZXJIVE1MID0gZXh0ID8gVUlGdWxsIDogVUlNaW47XG4gICAgICBzdmdOb2RlID0gc3ZnTm9kZS5jb250ZW50LmZpcnN0Q2hpbGQ7XG4gICAgICBkb21Ob2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyB0aGlzLnNob3dNUyA9ICF0aGlzLnNob3dNUzsgfSlcbiAgICAgIHdoaWxlICh1aUNvdW50LS0pIGRvbU5vZGUuYXBwZW5kQ2hpbGQoc3ZnTm9kZS5jbG9uZU5vZGUodHJ1ZSkpO1xuICAgICAgcm9vdE5vZGUuYXBwZW5kQ2hpbGQoZG9tTm9kZSk7XG5cbiAgICAgIGZ1bmN0aW9uIGxvZ2dlclRlbXBsYXRlKGV4dHJhTG9nZ2VyLCBlbG0sIGVsbUNoYW5nZXIsIHBjdCwgcGN0Q2hhbmdlcikge1xuICAgICAgICB0aGlzLmVsbSA9IGRvbU5vZGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShlbG0pO1xuICAgICAgICB0aGlzLnBjdCA9IGRvbU5vZGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShwY3QpO1xuICAgICAgICByZXR1cm4gKHgsIHksIGkpID0+IHtcbiAgICAgICAgICB0aGlzLmVsbVtpXS5pbm5lckhUTUwgPSBlbG1DaGFuZ2VyKHgsIHkpO1xuICAgICAgICAgIHRoaXMucGN0W2ldLnN0eWxlW3BjdCA9PSAnZ2wtYm94JyA/ICdmaWxsJyA6ICdzdHJva2VEYXNoYXJyYXknXSA9IHBjdENoYW5nZXIoeCk7XG4gICAgICAgICAgaWYgKGV4dHJhTG9nZ2VyKSBleHRyYUxvZ2dlcih4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5mcHNMb2dnZXIgPSBsb2dnZXJUZW1wbGF0ZS5iaW5kKHt9KSAodGhpcy5mcHNMb2dnZXIsXG4gICAgICAgICdnbC1mcHMnLCAoZnBzLCBtcykgPT4gIXRoaXMuc2hvd01TID8gZnBzLnRvRml4ZWQoMCkgKyAnIEZQUycgOiBtcy50b0ZpeGVkKDIpICsgJyBNUycsXG4gICAgICAgICdnbC1ib3gnLCBmcHMgPT4gJ2hzbGEoJyArIE1hdGgubWluKDEyMCwgTWF0aC5tYXgoMCwgMi4xODIqKGZwcy01KSkpICsgJyw1MCUsNjAlLDAuNjUpJ1xuICAgICAgKTtcbiAgICAgIHRoaXMuY3B1TG9nZ2VyID0gbG9nZ2VyVGVtcGxhdGUuYmluZCh7fSkgKHRoaXMuY3B1TG9nZ2VyLFxuICAgICAgICAnZ2wtY3B1JywgKGNwdSwgbXMpID0+ICF0aGlzLnNob3dNUyA/IGNwdS50b0ZpeGVkKDApICsgJyUnIDogbXMudG9GaXhlZCgyKSxcbiAgICAgICAgJ2dsLWNwdS1hcmMnLCBjcHUgPT4gY3B1LnRvRml4ZWQoMCkgKyAnLCAxMDAnXG4gICAgICApO1xuICAgICAgdGhpcy5ncHVMb2dnZXIgPSAhZXh0ID8gbnVsbCA6IGxvZ2dlclRlbXBsYXRlLmJpbmQoe30pICh0aGlzLmdwdUxvZ2dlcixcbiAgICAgICAgJ2dsLWdwdScsIChncHUsIG1zKSA9PiAhdGhpcy5zaG93TVMgPyBncHUudG9GaXhlZCgwKSArICclJyA6IG1zLnRvRml4ZWQoMiksXG4gICAgICAgICdnbC1ncHUtYXJjJywgZ3B1ID0+IGdwdS50b0ZpeGVkKDApICsgJywgMTAwJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoIWV4dCkge1xuICAgICAgdGhpcy5jcHUgPSBuZXcgQ1BVKHRoaXMuZnBzTG9nZ2VyLCB0aGlzLmNwdUxvZ2dlcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3B1ID0gbmV3IENQVShudWxsLCB0aGlzLmNwdUxvZ2dlcik7XG4gICAgICB0aGlzLmdwdSA9IG5ldyBHUFUod2ViZ2xDb250ZXh0LCBleHQsIHRoaXMuZnBzTG9nZ2VyLCB0aGlzLmdwdUxvZ2dlcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJlZ2luIG5hbWVkIG1lYXN1cmVcbiAgICogQHBhcmFtIHsgc3RyaW5nIHwgdW5kZWZpbmVkIH0gbmFtZVxuICAgKi9cbiAgYmVnaW4obmFtZSkge1xuICAgIGxldCBuYW1lSWQgPSB0aGlzLm5hbWVzLmluZGV4T2YobmFtZSk7XG4gICAgaWYgKHRoaXMubmFtZXMuaW5kZXhPZihuYW1lKSA9PSAtMSkge1xuICAgICAgbmFtZUlkID0gdGhpcy5uYW1lcy5sZW5ndGg7XG4gICAgICB0aGlzLm5hbWVzLnB1c2gobmFtZSk7XG4gICAgfVxuXG4gICAgdGhpcy5jcHUuYmVnaW4obmFtZUlkKTtcbiAgICBpZiAodGhpcy5ncHUpIHRoaXMuZ3B1LmJlZ2luKG5hbWVJZCk7XG4gIH1cblxuICAvKipcbiAgICogRW5kIG5hbWVkIG1lYXN1cmVcbiAgICogQHBhcmFtIHsgc3RyaW5nIHwgdW5kZWZpbmVkIH0gbmFtZVxuICAgKi9cbiAgZW5kKG5hbWUpIHtcbiAgICBjb25zdCBuYW1lSWQgPSB0aGlzLm5hbWVzLmluZGV4T2YobmFtZSk7XG4gICAgdGhpcy5jcHUuZW5kKG5hbWVJZCk7XG4gICAgaWYgKHRoaXMuZ3B1KSB0aGlzLmdwdS5lbmQobmFtZUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9iYWJseSBzaG91bGQgYmUgcmVtb3ZlZFxuICAgKi9cbiAgdXBkYXRlKCkge1xuICAgIGlmICghdGhpcy5maXJzdFVwZGF0ZSkgdGhpcy5maXJzdFVwZGF0ZSA9IHRydWU7XG4gICAgZWxzZSB0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
