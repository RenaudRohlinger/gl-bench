'use strict';var GlBench=function(){class f{constructor(a,b,d,c){this.fpsLogger=a;this.measureLogger=b;this.gl=d;this.ext=c;this.measureAccum=this.elapsedAccum=this.frameId=0;this.queue=[{query:this.gl.createQuery(),isMeasure:!1,frameId:this.frameId}]}begin(){if("undefined"==typeof this.queryId)this.queryId=0,this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queue[0].query);else{this.frameId++;for(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)&&this.queue[this.queryId]&&
this.gl.getQueryParameter(this.queue[this.queryId].query,this.gl.QUERY_RESULT_AVAILABLE);){var a=this.gl.getQueryParameter(this.queue[this.queryId].query,this.gl.QUERY_RESULT);this.elapsedAccum+=a;this.measureAccum+=this.queue[this.queryId].isMeasure?a:0;a=this.elapsedAccum/1E9;this.queryId++;if(1<=a){let b=(this.queue[this.queryId-1].frameId-this.queue[0].frameId)/a,d=100*this.measureAccum/this.elapsedAccum;for(;1<=a;)this.fpsLogger(b),this.measureLogger(d),a--;this.queue.slice(0,this.queryId).forEach(a=>
this.gl.deleteQuery(a.query));this.queue.splice(0,this.queryId);this.queryId=this.measureAccum=this.elapsedAccum=0}}this.queue.push({query:this.gl.createQuery(),isMeasure:!1,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queue[this.queue.length-1].query)}}end(){this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);this.queue[this.queue.length-1].isMeasure=!0;this.queue.push({query:this.gl.createQuery(),isMeasure:!1,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,
this.queue[this.queue.length-1].query)}}class g{constructor(a,b){this.fpsLogger=a;this.measureLogger=b;this.measureAccum=this.frameCount=0}now(){return"undefined"==typeof performance?Date.now():performance.now()}begin(){if("undefined"==typeof this.zerotime)this.timestamp=this.zerotime=this.now();else{this.frameCount++;this.timestamp=this.now();var a=this.timestamp-this.zerotime;let b=a/1E3;if(1<=b){let d=this.frameCount/b;for(a=100*this.measureAccum/a;1<=b;)this.fpsLogger(d),this.measureLogger(a),
b--;this.frameCount=this.measureAccum=0;this.zerotime=this.timestamp}}}end(){this.measureAccum+=this.now()-this.timestamp}}class h{constructor(a=!0,b=null){this.isDefaultUI=a;this.isDefaultLoggers=!b;this.loggers=b?b:{}}init(a=null){if(!a){var b=document.getElementsByTagName("canvas");for(var d=0;d<b.length;d++)if(0==d||a.width*a.height<b[d].width*b[d].height)a=b[d]}let c,e;if(a instanceof HTMLCanvasElement)if(e=a.getContext("webgl")||a.getContext("experimental-webgl")){if(c=e.getExtension("EXT_disjoint_timer_query"))e.createQuery=
c.createQueryEXT.bind(c),e.deleteQuery=c.deleteQueryEXT.bind(c),e.beginQuery=c.beginQueryEXT.bind(c),e.endQuery=c.endQueryEXT.bind(c),e.getQueryParameter=c.getQueryObjectEXT.bind(c),e.QUERY_RESULT_AVAILABLE=c.QUERY_RESULT_AVAILABLE_EXT,e.QUERY_RESULT=c.QUERY_RESULT_EXT}else c=(e=a.getContext("webgl2"))?e.getExtension("EXT_disjoint_timer_query_webgl2"):null;this.isDefaultUI&&(a=a instanceof HTMLCanvasElement?a.parentNode:document.body,b=document.getElementById("gl-bench-dom"),b||(b=document.createElement("div"),
b.id="gl-bench-dom",d=document.createElement("style"),d.innerHTML="#gl-bench-dom {\n  position: absolute;\n  left: 0;\n  top: 0;\n  margin: 0;\n}\n\n.gl-bench {\n  position: relative;\n  display: block;\n  margin: 5px;\n  cursor: pointer;\n  width: 100px;\n}\n\n.gl-bench-text {\n  font-family: sans-serif;\n  font-weight: 700;\n  dominant-baseline: middle;\n  text-anchor: middle;\n  opacity: 0.7;\n}\n",a.appendChild(d)),d=document.createElement("template"),d.innerHTML=c?'<svg viewBox="0 0 100 70" class="gl-bench">\n\n<rect x="0" y="0" width="100" height="70" rx="25" ry="25" id="gl-bench-rect"\n  style="fill:#999;stroke-width:0;opacity:0.7"/>\n\n<text x="25" y="22" class="gl-bench-text" font-size="0.7em" id="gl-bench-cpu">00%</text>\n<text x="25" y="33" class="gl-bench-text" font-size="0.7em">CPU</text>\n<circle cx="26.5" cy="26.5" r="20" stroke-width="3.5"\n  fill="none" stroke="black" style="opacity:0.4"/>\n\n<circle cx="74.5" cy="26.5" r="20" stroke-width="3.5"\n  fill="none" stroke="black" style="opacity:0.4"/>\n<text x="75" y="22" class="gl-bench-text" font-size="0.7em" id="gl-bench-gpu">00%</text>\n<text x="75" y="33" class="gl-bench-text" font-size="0.7em">GPU</text>\n\n<text x="50" y="59" class="gl-bench-text" font-size=".8em" id="gl-bench-fps">00 FPS</text>\n<circle cx="18" cy="58" r="3" style="opacity:0.4"/>\n<circle cx="82" cy="58" r="3" style="opacity:0.4"/>\n\n</svg>':
'<svg viewBox="0 0 95 50" class="gl-bench">\n\n<rect x="0" y="0" width="95" height="50" rx="25" ry="25" id="gl-bench-rect"\n  style="fill:#999;stroke:black;stroke-width:0;opacity:0.7" />\n\n<text x="25" y="20" class="gl-bench-text" font-size="0.7em" id="gl-bench-cpu">00%</text>\n<text x="25" y="33" class="gl-bench-text" font-size="0.7em">CPU</text>\n<circle cx="25" cy="25" r="20" fill="none"\n  stroke-width="3" stroke="black" style="opacity:0.4"/>\n\n<text x="70" y="27" class="gl-bench-text" font-size="0.75em" id="gl-bench-fps">00 FPS</text>\n\n</svg>',
b.appendChild(d.content.firstChild),a.appendChild(b));this.isDefaultLoggers&&this.isDefaultUI&&(this.loggers.cpuMeasure=a=>{a=a.toFixed(0)+"%";document.getElementById("gl-bench-cpu").innerHTML=a},this.loggers.cpuFps=a=>{a=a.toFixed(0)+" FPS";document.getElementById("gl-bench-fps").innerHTML=a},c&&(this.loggers.gpuMeasure=a=>{a=a.toFixed(0)+"%";document.getElementById("gl-bench-gpu").innerHTML=a},this.loggers.gpuFps=a=>{a=a.toFixed(0)+" FPS";document.getElementById("gl-bench-fps").innerHTML=a},this.loggers.cpuFps=
()=>{}));this.cpu=new g(this.loggers.cpuFps,this.loggers.cpuMeasure);this.gpu=c?new f(this.loggers.gpuFps,this.loggers.gpuMeasure,e,c):null}begin(){this.gpu?(this.gpu.begin(),this.cpu.begin()):this.cpu?this.cpu.begin():(this.init(),this.begin())}end(){this.gpu?(this.gpu.end(),this.cpu.end()):this.cpu&&this.cpu.end()}update(){this.begin();this.gpu&&(this.cpu.fpsLogger=()=>{})}}return h}();
