'use strict';var GLBench=function(){class f{constructor(a,b,c,e){this.fpsLogger=c?c:()=>{};this.measureLogger=e?e:()=>{};this.frameId=0;this.names=[null];this.namedAccums={};this.queryId=this.totalAccum=this.measureMode=0;this.queryQueue=[];b&&"EXTDisjointTimerQuery"==b.constructor.name&&(a.createQuery=b.createQueryEXT.bind(b),a.deleteQuery=b.deleteQueryEXT.bind(b),a.beginQuery=b.beginQueryEXT.bind(b),a.endQuery=b.endQueryEXT.bind(b),a.getQueryParameter=b.getQueryObjectEXT.bind(b),a.QUERY_RESULT_AVAILABLE=
b.QUERY_RESULT_AVAILABLE_EXT,a.QUERY_RESULT=b.QUERY_RESULT_EXT);this.gl=a;this.ext=b}begin(a){a===this.names[0]&&this.frameId++;-1==this.names.indexOf(a)&&(0==this.frameId?this.names[0]=a:this.names.push(a),this.namedAccums[a]=0);if(0!=this.frameId)for(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)&&this.queryQueue[this.queryId]&&this.gl.getQueryParameter(this.queryQueue[this.queryId].query,this.gl.QUERY_RESULT_AVAILABLE);){var b=this.gl.getQueryParameter(this.queryQueue[this.queryId].query,
this.gl.QUERY_RESULT);this.totalAccum+=b;var c=this.queryQueue[this.queryId].measureMode.toString(2);for(var e=0;e<c.length;e++)"1"==c[e]&&(this.namedAccums[this.names[c.length-e-1]]+=b);this.queryId++;b=this.totalAccum/1E9;if(1<=b){c=(this.queryQueue[this.queryId-1].frameId-this.queryQueue[0].frameId)/b;for(e=this.names.map(a=>100*this.namedAccums[a]/this.totalAccum);1<=b;){for(let a=0;a<this.names.length;a++)this.fpsLogger(c,a),this.measureLogger(e[a],a);b--}this.queryQueue.slice(0,this.queryId).forEach(a=>
this.gl.deleteQuery(a.query));this.queryQueue.splice(0,this.queryId);this.names.forEach(a=>this.namedAccums[a]=0);this.queryId=this.totalAccum=0}}this.measureMode+=1<<this.names.indexOf(a);this.queryQueue.push({query:this.gl.createQuery(),measureMode:this.measureMode,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queryQueue[this.queryQueue.length-1].query)}end(a){this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);this.measureMode-=1<<this.names.indexOf(a);this.queryQueue.push({query:this.gl.createQuery(),
measureMode:this.measureMode,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queryQueue[this.queryQueue.length-1].query)}}class g{constructor(a,b){this.fpsLogger=a?a:()=>{};this.measureLogger=b?b:()=>{};this.frameId=0;this.names=[null];this.namedAccums={};this.measureMode=0}now(){return performance&&performance.now?performance.now():Date.now()}begin(a){a===this.names[0]&&this.frameId++;-1==this.names.indexOf(a)&&(0==this.frameId?this.names[0]=a:this.names.push(a),this.namedAccums[a]=
0,this.timestamp=this.zerotime=this.now());if(0!=this.frameId){this.timestamp=this.now();let a=this.timestamp-this.zerotime,c=a/1E3;if(1<=c){let b=this.frameId/c,d=this.names.map(b=>100*this.namedAccums[b]/a);for(;1<=c;){for(let a=0;a<this.names.length;a++)this.fpsLogger(b,a),this.measureLogger(d[a],a);c--}this.names.forEach(a=>this.namedAccums[a]=0);this.frameId=0;this.zerotime=this.timestamp}}this.measureMode+=1<<this.names.indexOf(a)}end(a){let b=this.now()-this.timestamp,c=this.measureMode.toString(2);
for(let a=0;a<c.length;a++)"1"==c[a]&&(this.namedAccums[this.names[c.length-a-1]]+=b);this.measureMode-=1<<this.names.indexOf(a)}}class h{constructor(a=null,b=!0){this.isDefaultUI=b;this.loggers=a?{new:a}:{}}init(a){let b,c;a instanceof HTMLCanvasElement&&(a=a.getContext("webgl")||a.getContext("experimental-webgl")||a.getContext("webgl2"));a instanceof WebGLRenderingContext?(c=a,b=c.getExtension("EXT_disjoint_timer_query")):a instanceof WebGL2RenderingContext&&(c=a,b=c.getExtension("EXT_disjoint_timer_query_webgl2"));
if(this.isDefaultUI){a=a instanceof HTMLCanvasElement?a.parentNode:document.body;let c=document.getElementById("gl-bench-dom");if(!c){c=document.createElement("div");c.id="gl-bench-dom";let b=document.createElement("style");b.innerHTML="#gl-bench-dom {\n  position: absolute;\n  left: 0;\n  top: 0;\n  margin: 0;\n}\n\n.gl-bench {\n  position: relative;\n  display: block;\n  margin: 5px;\n  width: 100px;\n}\n\n.gl-bench-rect {\n  fill: hsla(120, 50%, 60%, 0.65);\n}\n\n.gl-bench-text {\n  font-family: sans-serif;\n  font-weight: 700;\n  font-size: 0.7em;\n  dominant-baseline: middle;\n  text-anchor: middle;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  opacity: 0.7;\n}\n\n.gl-bench-progress {\n  fill: none;  \n  stroke: black;\n  stroke-width: 2.6;\n  opacity: 0.5;  \n  transform: scale(1.25663);\n  stroke-dasharray: 0, 100;\n}\n\n.gl-bench-circle {\n  fill: none;\n  stroke: black;\n  opacity: 0.4;\n}";
a.appendChild(b)}let d=document.createElement("template");d.innerHTML=b?'<svg viewBox="0 0 100 70" class="gl-bench">\n\n<rect x="0" y="0" width="100" height="70" rx="26.5" ry="26.5" class="gl-bench-rect"/>\n\n<text x="26.5" y="22" class="gl-bench-text gl-bench-cpu">00%</text>\n<text x="26.5" y="34" class="gl-bench-text">CPU</text>\n<circle cx="26.5" cy="26.5" r="20" stroke-width="3.5" class="gl-bench-circle"/>\n<path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"\n  class="gl-bench-progress gl-bench-cpu-progress"/>\n\n<circle cx="73.5" cy="26.5" r="20" stroke-width="3.5" class="gl-bench-circle"/>\n<text x="73.5" y="22" class="gl-bench-text gl-bench-gpu">00%</text>\n<text x="73.5" y="34" class="gl-bench-text">GPU</text>\n<path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"\n  class="gl-bench-progress gl-bench-gpu-progress"/>\n\n<text x="50" y="59" font-size=".8em" class="gl-bench-text gl-bench-fps">00 FPS</text>\n<circle cx="18" cy="58" r="3" style="opacity:0.55"/>\n<circle cx="82" cy="58" r="3" style="opacity:0.55"/>\n\n</svg>':
'<svg viewBox="0 0 100 52.632" class="gl-bench">\n\n<rect x="0" y="0" width="100" height="52.632" rx="26.5" ry="26.5" class="gl-bench-rect"/>\n\n<text x="26.5" y="22" class="gl-bench-text gl-bench-cpu">00%</text>\n<text x="26.5" y="34" class="gl-bench-text">CPU</text>\n<circle cx="26.5" cy="26.5" r="20" stroke-width="3.5" class="gl-bench-circle"/>\n<path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"\n  class="gl-bench-progress gl-bench-cpu-progress"/>\n\n<text x="74" y="28" font-size="0.8em" class="gl-bench-text gl-bench-fps">00 FPS</text>\n\n</svg>';
d=d.content.firstChild;this.loggers.cpuMeasure=(()=>{let a=d.getElementsByClassName("gl-bench-cpu"),b=d.getElementsByClassName("gl-bench-cpu-progress");return(c,d)=>{a[d].innerHTML=c.toFixed(0)+"%";b[d].style.strokeDasharray=c.toFixed(0)+", 100";this.loggers.new&&this.loggers.new.cpuMeasure&&this.loggers.new.cpuMeasure(c)}})();this.loggers.cpuFps=(()=>{let a=d.getElementsByClassName("gl-bench-fps"),b=d.getElementsByClassName("gl-bench-rect");return(c,d)=>{a[d].innerHTML=c.toFixed(0)+" FPS";b[d].style.fill=
"hsla("+Math.min(120,Math.max(0,2.182*(c-5))).toFixed(0)+", 50%, 60%, 0.65)";this.loggers.new&&this.loggers.new.cpuFps&&this.loggers.new.cpuFps(c)}})();b&&(this.loggers.gpuMeasure=(()=>{let a=d.getElementsByClassName("gl-bench-gpu"),b=d.getElementsByClassName("gl-bench-gpu-progress");return(c,d)=>{a[d].innerHTML=c.toFixed(0)+"%";b[d].style.strokeDasharray=c.toFixed(0)+", 100";this.loggers.new&&this.loggers.new.gpuMeasure&&this.loggers.new.gpuMeasure(c)}})(),this.loggers.gpuFps=(()=>{let a=d.getElementsByClassName("gl-bench-fps"),
b=d.getElementsByClassName("gl-bench-rect");return(c,d)=>{a[d].innerHTML=c.toFixed(0)+" FPS";b[d].style.fill="hsla("+Math.min(120,Math.max(0,2.182*(c-5))).toFixed(0)+", 50%, 60%, 0.65)";this.loggers.new&&this.loggers.new.cpuFps&&this.loggers.new.cpuFps(c)}})(),this.loggers.cpuFps=()=>{});c.appendChild(d);a.appendChild(c)}else this.loggers.new&&Object.assign(this.loggers,this.loggers.new);this.cpu=new g(this.loggers.cpuFps,this.loggers.cpuMeasure);this.gpu=b?new f(c,b,this.loggers.gpuFps,this.loggers.gpuMeasure):
null}begin(a){this.gpu?(this.cpu.begin(a),this.gpu.begin(a)):this.cpu?this.cpu.begin(a):(this.init(),this.begin(a))}end(a){this.gpu?(this.cpu.end(a),this.gpu.end(a)):this.cpu&&this.cpu.end(a)}update(){this.begin()}}return h}();
