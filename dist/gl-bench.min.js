'use strict';var GLBench=function(){class f{constructor(a,b,c,d){this.fpsLogger=c?c:()=>{};this.gpuLogger=d?d:()=>{};this.frameId=0;this.namedAccums=[];this.queryId=this.measureMode=0;this.queryQueue=[];this.totalAccum=0;b&&"EXTDisjointTimerQuery"==b.constructor.name&&(a.createQuery=b.createQueryEXT.bind(b),a.deleteQuery=b.deleteQueryEXT.bind(b),a.beginQuery=b.beginQueryEXT.bind(b),a.endQuery=b.endQueryEXT.bind(b),a.getQueryParameter=b.getQueryObjectEXT.bind(b),a.QUERY_RESULT_AVAILABLE=b.QUERY_RESULT_AVAILABLE_EXT,
a.QUERY_RESULT=b.QUERY_RESULT_EXT);this.gl=a;this.ext=b}begin(a){0===a&&this.frameId++;this.namedAccums.length<=a&&this.namedAccums.push(0);this.measureMode+=1<<a;this.update()}end(a){this.measureMode-=1<<a;this.update()}update(){if(0<this.queryQueue.length)for(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)&&this.gl.getQueryParameter(this.queryQueue[this.queryId].query,this.gl.QUERY_RESULT_AVAILABLE);){var a=this.gl.getQueryParameter(this.queryQueue[this.queryId].query,
this.gl.QUERY_RESULT);this.totalAccum+=a;var b=this.queryQueue[this.queryId].measureMode.toString(2);for(var c=0;c<b.length;c++)"1"==b[c]&&(this.namedAccums[b.length-c-1]+=a);this.queryId++;b=this.totalAccum/1E9;if(1<=b){a=this.queryQueue[this.queryId-1].frameId-this.queryQueue[0].frameId;b=a/b;c=this.totalAccum/a/1E6;for(let d=0;d<this.namedAccums.length;d++){let e=this.namedAccums[d];this.gpuLogger(e/this.totalAccum*100,e/a/1E6,d);this.fpsLogger(b,c,d)}this.queryQueue.slice(0,this.queryId).forEach(a=>
this.gl.deleteQuery(a.query));this.queryQueue.splice(0,this.queryId);for(a=this.namedAccums.length;a--;)this.namedAccums[a]=0;this.queryId=this.totalAccum=0}}this.queryQueue.push({query:this.gl.createQuery(),measureMode:this.measureMode,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queryQueue[this.queryQueue.length-1].query)}}class g{constructor(a,b){this.fpsLogger=a?a:()=>{};this.cpuLogger=b?b:()=>{};this.frameId=0;this.namedAccums=[];this.measureMode=0;this.zerotime=null}begin(a){0===
a&&this.frameId++;this.namedAccums.length<=a&&this.namedAccums.push(0);this.update();this.measureMode+=1<<a}end(a){this.update();this.measureMode-=1<<a}update(){let a=performance&&performance.now?performance.now():Date.now();if(null==this.zerotime)this.zerotime=a;else{var b=a-this.timestamp,c=this.measureMode.toString(2);for(var d=0;d<c.length;d++)"1"==c[d]&&(this.namedAccums[c.length-d-1]+=b);b=this.timestamp-this.zerotime;c=b/1E3;if(1<=c){c=this.frameId/c;d=b/this.frameId;for(let a=0;a<this.namedAccums.length;a++){let e=
this.namedAccums[a];this.cpuLogger(e/b*100,e/this.frameId,a);this.fpsLogger(c,d,a)}for(b=this.namedAccums.length;b--;)this.namedAccums[b]=0;this.frameId=0;this.zerotime=this.timestamp}}this.timestamp=a}}class l{constructor(a,b={}){this.names=[];Object.assign(this,b);if(!this.withoutUI&&"undefined"!=typeof window){b=function(a,b,e,f,h,k,g){this.elm=k.getElementsByClassName(a);this.pct=k.getElementsByClassName(e);this.names=g;return(a,c,d)=>{this.elm[d].innerHTML=b(a,c);this.pct[d].style["gl-box"==
e?"fill":"strokeDasharray"]=f(a);h&&h(a,c,this.names[d])}};this.dom=document.getElementById("gl-bench-dom");if(!this.dom){document.body.insertAdjacentHTML("afterbegin",'<div id="gl-bench-dom" style="position:absolute;left:0;top:0;z-index:1000"></div>');this.dom=document.getElementById("gl-bench-dom");let a=document.createElement("style");a.innerHTML=".gl-bench{position:relative;display:block;margin:5px;width:100px;cursor:pointer;}.gl-box{fill:hsla(120, 50%, 60%, 0.65);}.gl-text{font-family:sans-serif;font-weight:700;font-size:0.7em;text-anchor:middle;dominant-baseline:middle;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.7;}.gl-arc{fill:none;stroke:black;stroke-width:2.6;stroke-dasharray:0, 100;opacity:0.5;transform:scale(1.25663);}.gl-circle{fill:none;stroke-width:3.5;stroke:black;opacity:0.4;}";
this.dom.appendChild(a)}this.dom.addEventListener("click",()=>{this.showMS=!this.showMS});this.fpsLogger=b.bind({})("gl-fps",(a,b)=>this.showMS?b.toFixed(2)+" MS":a.toFixed(0)+" FPS","gl-box",a=>"hsla("+Math.min(120,Math.max(0,2.182*(a-5)))+",50%,60%,0.65)",this.fpsLogger,this.dom,this.names);this.cpuLogger=b.bind({})("gl-cpu",(a,b)=>this.showMS?b.toFixed(2):a.toFixed(0)+"%","gl-cpu-arc",a=>a.toFixed(0)+", 100",this.cpuLogger,this.dom,this.names);this.gpuLogger=b.bind({})("gl-gpu",(a,b)=>this.showMS?
b.toFixed(2):a.toFixed(0)+"%","gl-gpu-arc",a=>a.toFixed(0)+", 100",this.gpuLogger,this.dom,this.names)}if(!this.withoutBenchmarks){let b;a instanceof WebGLRenderingContext?b=a.getExtension("EXT_disjoint_timer_query"):a instanceof WebGL2RenderingContext&&(b=a.getExtension("EXT_disjoint_timer_query_webgl2"));this.withoutEXT&&(b=0);this.cpu=new g(b?0:this.fpsLogger,this.cpuLogger);b&&(this.gpu=new f(a,b,this.fpsLogger,this.gpuLogger))}}addUI(a){this.names.push(a);this.dom&&this.dom.insertAdjacentHTML("beforeend",
this.gpu?'<svg viewBox="0 0 100 70" class="gl-bench"><rect x="0" y="0" width="100" height="70" rx="26.5" ry="26.5" class="gl-box"/><text x="26.5" y="22" class="gl-text gl-cpu">00%</text><text x="26.5" y="34" class="gl-text">CPU</text><circle cx="26.5" cy="26.5" r="20" class="gl-circle"/><path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"class="gl-arc gl-cpu-arc"/><circle cx="73.5" cy="26.5" r="20" class="gl-circle"/><text x="73.5" y="22" class="gl-text gl-gpu">00%</text><text x="73.5" y="34" class="gl-text">GPU</text><path d="M58.5 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"class="gl-arc gl-gpu-arc"/><text x="50" y="59" font-size=".8em" class="gl-text gl-fps">00 FPS</text><circle cx="18" cy="58" r="3" style="opacity:0.55"/><circle cx="82" cy="58" r="3" style="opacity:0.55"/></svg>':
'<svg viewBox="0 0 100 52.632" class="gl-bench"><rect x="0" y="0" width="100" height="52.632" rx="26.5" ry="26.5" class="gl-box"/><text x="26.5" y="22" class="gl-text gl-cpu" >00%</text><text x="26.5" y="34" class="gl-text">CPU</text><circle cx="26.5" cy="26.5" r="20" stroke-width="3.5" class="gl-circle"/><path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"class="gl-arc gl-cpu-arc"/><text x="74" y="28" class="gl-text gl-fps" style="font-size:0.8em">00 FPS</text></svg>')}begin(a){let b=
this.names.indexOf(a);-1==this.names.indexOf(a)&&(b=this.names.length,this.addUI(a));this.cpu.begin(b);this.gpu&&this.gpu.begin(b)}end(a){a=this.names.indexOf(a);this.cpu.end(a);this.gpu&&this.gpu.end(a)}}return l}();
