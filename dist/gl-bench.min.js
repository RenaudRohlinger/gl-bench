'use strict';var GLBench=function(){class f{constructor(a,c={}){this.names=[];Object.assign(this,c);let d=(b,e)=>function(){var c=e.now();b.apply(a,arguments);var d=new Uint8Array(4);a.readPixels(0,0,1,1,a.RGBA,a.UNSIGNED_BYTE,d);c=e.now()-c;d=e.measureMode.toString(2);for(let b=0;b<d.length;b++)if("1"==d[b]){const a=d.length-b-1;e.cpuAccums[a]-=c;e.gpuAccums[a]+=c}};(a instanceof WebGLRenderingContext||a instanceof WebGL2RenderingContext)&&"drawArrays drawElements drawArraysInstanced drawBuffers drawElementsInstanced drawRangeElements".split(" ").forEach(b=>
{a[b]&&(a[b]=d(a[b],this))});if(!this.withoutUI){c=function(b,a,c,d,g,h,f){this.elm=h.getElementsByClassName(b);this.pct=h.getElementsByClassName(c);this.names=f;return(b,e,f)=>{this.elm[f].innerHTML=a(b,e);this.pct[f].style["gl-box"==c?"fill":"strokeDasharray"]=d(b);g&&g(b,e,this.names[f])}};this.dom=document.getElementById("gl-bench-dom");if(!this.dom){document.body.insertAdjacentHTML("afterbegin",'<div id="gl-bench-dom" style="position:absolute;left:0;top:0;z-index:1000"></div>');this.dom=document.getElementById("gl-bench-dom");
let b=document.createElement("style");b.innerHTML=".gl-bench{position:relative;display:block;margin:5px;width:100px;cursor:pointer;}.gl-box{fill:hsla(120, 50%, 60%, 0.65);}.gl-text{font-family:sans-serif;font-weight:700;font-size:0.7em;text-anchor:middle;dominant-baseline:middle;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.7;}.gl-arc{fill:none;stroke:black;stroke-width:2.6;stroke-dasharray:0, 100;opacity:0.5;transform:scale(1.25663);}.gl-circle{fill:none;stroke-width:3.5;stroke:black;opacity:0.4;}";
this.dom.appendChild(b)}this.dom.addEventListener("click",()=>{this.showMS=!this.showMS});this.fpsLogger=c.bind({})("gl-fps",(b,a)=>this.showMS?a.toFixed(2)+" MS":b.toFixed(0)+" FPS","gl-box",b=>"hsla("+Math.min(120,Math.max(0,2.182*(b-5)))+",50%,60%,0.65)",this.fpsLogger,this.dom,this.names);this.cpuLogger=c.bind({})("gl-cpu",(b,a)=>this.showMS?a.toFixed(2):b.toFixed(0)+"%","gl-cpu-arc",b=>b.toFixed(0)+", 100",this.cpuLogger,this.dom,this.names);this.gpuLogger=c.bind({})("gl-gpu",(b,a)=>this.showMS?
a.toFixed(2):b.toFixed(0)+"%","gl-gpu-arc",b=>b.toFixed(0)+", 100",this.gpuLogger,this.dom,this.names)}this.cpuLogger||(this.cpuLogger=()=>{});this.gpuLogger||(this.gpuLogger=()=>{});this.fpsLogger||(this.fpsLogger=()=>{});this.now=()=>performance&&performance.now?performance.now():Date.now();this.frameId=0;this.cpuAccums=[];this.gpuAccums=[];this.measureMode=0}addUI(a){this.names.push(a);this.dom&&this.dom.insertAdjacentHTML("beforeend",'<svg viewBox="0 0 100 70" class="gl-bench"><rect x="0" y="0" width="100" height="70" rx="26.5" ry="26.5" class="gl-box"/><text x="26.5" y="22" class="gl-text gl-cpu">00%</text><text x="26.5" y="34" class="gl-text">CPU</text><circle cx="26.5" cy="26.5" r="20" class="gl-circle"/><path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"class="gl-arc gl-cpu-arc"/><circle cx="73.5" cy="26.5" r="20" class="gl-circle"/><text x="73.5" y="22" class="gl-text gl-gpu">00%</text><text x="73.5" y="34" class="gl-text">GPU</text><path d="M58.5 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"class="gl-arc gl-gpu-arc"/><text x="50" y="59" font-size=".8em" class="gl-text gl-fps">00 FPS</text><circle cx="18" cy="58" r="3" style="opacity:0.55"/><circle cx="82" cy="58" r="3" style="opacity:0.55"/></svg>')}begin(a){let c=
this.names.indexOf(a);-1==this.names.indexOf(a)&&(c=this.names.length,this.addUI(a));0===c&&this.frameId++;this.cpuAccums.length<=c&&this.cpuAccums.push(0);this.gpuAccums.length<=c&&this.gpuAccums.push(0);this.update();this.measureMode+=1<<c}end(a){a=this.names.indexOf(a);this.update();this.measureMode-=1<<a}update(){let a=this.now();if("undefined"==typeof this.zerotime)this.zerotime=a;else{var c=a-this.prevNow,d=this.measureMode.toString(2);for(var b=0;b<d.length;b++)"1"==d[b]&&(this.cpuAccums[d.length-
b-1]+=c);c=a-this.zerotime;d=c/1E3;if(1<=d){d=this.frameId/d;b=c/this.frameId;for(let a=0;a<this.cpuAccums.length;a++)this.cpuLogger(this.cpuAccums[a]/c*100,this.cpuAccums[a]/this.frameId,a),this.gpuLogger(this.gpuAccums[a]/c*100,this.gpuAccums[a]/this.frameId,a),this.fpsLogger(d,b,a);for(c=this.cpuAccums.length;c--;)this.cpuAccums[c]=0,this.gpuAccums[c]=0;this.frameId=0;this.zerotime=a}}this.prevNow=a}}return f}();
