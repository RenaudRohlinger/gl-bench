'use strict';var GLBench=function(){class g{constructor(a,c={}){this.css="#gl-bench{position:absolute;left:0;top:0;z-index:1000;-webkit-user-select:none;-moz-user-select:none;user-select:none;}#gl-bench svg{height:60px;margin:0 -1px;}#gl-bench div{position:relative;display:block;margin:5px;padding:0 7px 0 10px;background:hsla(120, 50%, 60%, 1);border-radius:15px;cursor:pointer;opacity:0.9;}#gl-bench text{font-family:Helvetica,Arial,sans-serif;font-weight:700;dominant-baseline:middle;text-anchor:middle;}#gl-bench line{stroke-width:5;stroke:black;stroke-linecap:round;}#gl-bench polyline{fill:none;stroke:black;stroke-linecap:round;stroke-linejoin:round;stroke-width:3.5;opacity:0.8;}";
this.svg='<div class="gl-box"><svg viewBox="0 0 55 60"><text x="27" y="56" font-size="0.75em" class="gl-fps">00 FPS</text><text x="28" y="8" font-size="0.55rem" class="gl-mem"></text><rect x="0" y="14" rx="4" ry="4" width="55" height="32" opacity="0.4"/><polyline points="0 0 0 0" class="gl-chart"/></svg><svg viewBox="0 0 14 60"><line x1="7" y1="38" x2="7" y2="11" opacity="0.4"/><line x1="7" y1="38" x2="7" y2="11" opacity="0.7" stroke-dasharray="0 27" class="gl-cpu"/><path transform="translate(1,43) scale(.29)" d="m15 0c-1.6 3e-16 -2.8 1.3-2.8 2.8v4c-2.7 0.68-4.9 2.8-5.5 5.6h-4c-1.5 0-2.8 1.2-2.8 2.8s1.2 2.8 2.8 2.8h3.8v5.7h-3.7c-1.6 0-2.8 1.3-2.8 2.8 3e-16 1.6 1.3 2.8 2.8 2.8h3.9c0.67 2.7 2.8 4.8 5.5 5.5v3.9c0 1.6 1.3 2.8 2.8 2.8 1.6 0 2.8-1.3 2.8-2.8v-3.7h5.7v3.7c0 1.6 1.3 2.8 2.8 2.8 1.6 0 2.8-1.3 2.8-2.8v-3.9c2.7-0.67 4.8-2.8 5.5-5.5h3.9c1.6 0 2.8-1.3 2.8-2.8 0-1.6-1.3-2.8-2.8-2.8h-3.7v-5.7h3.8c1.5 0 2.8-1.2 2.8-2.8s-1.2-2.8-2.8-2.8h-4c-0.65-2.7-2.8-4.9-5.5-5.6v-3.9c0-1.6-1.3-2.8-2.8-2.8-1.6 3e-16 -2.8 1.3-2.8 2.8v3.7h-5.7v-3.7c0-1.6-1.3-2.8-2.8-2.8zm2 12h7.2c2.6 0 4.7 2.1 4.7 4.7v7.2c0 2.6-2.1 4.7-4.7 4.7h-7.2c-2.6 0-4.7-2.1-4.7-4.7v-7.2c0-2.6 2.1-4.7 4.7-4.7z"/></svg><svg viewBox="0 0 14 60" class="gl-gpu-svg"><line x1="7" y1="38" x2="7" y2="11" opacity="0.4"/><line x1="7" y1="38" x2="7" y2="11" opacity="0.7" stroke-dasharray="0 27" class="gl-gpu"/><path transform="translate(0.93,43) scale(1.15)" d="m0.88 0.33c-0.85-0.0024-0.86 1.3-0.0036 1.3 0.48 0.015 0.57 0.48 0.59 0.89v7.4c0 0.85 1.3 0.85 1.3 0v-1.1c1.8-0.018 3.5-0.0083 5.3-0.0083 1.1-1.6e-5 2-0.85 2-1.9v-2.7c0-1-0.88-1.9-2-1.9-1.8 8.2e-6 -3.5 5.7e-5 -5.3 5e-5 0 0-0.013-0.42-0.17-0.84-0.2-0.53-0.78-1.1-1.7-1.1zm2.5 3.2c0.37 0 0.67 0.32 0.67 0.71v2.6c0 0.39-0.3 0.71-0.67 0.71s-0.67-0.32-0.67-0.71v-2.6c0-0.39 0.3-0.71 0.67-0.71zm3.6 0c1.1 0 2 0.9 2 2s-0.9 2-2 2-2-0.9-2-2 0.9-2 2-2z"/></svg></div>';
this.paramLogger=()=>{};this.chartLogger=()=>{};this.chartLen=20;this.names=[];this.cpuAccums=[];this.gpuAccums=[];this.activeAccums=[];this.chart=Array(this.chartLen);this.now=()=>performance&&performance.now?performance.now():Date.now();Object.assign(this,c);this.frameId=-1;if(a){let c=(b,d,f)=>function(){const c=d.now();b.apply(f,arguments);if(!d.withoutGPU){a.readPixels(0,0,1,1,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(4));const f=d.now()-c;d.activeAccums.forEach((a,b)=>{a&&(d.gpuAccums[b]+=f,d.cpuAccums[b]-=
f)})}};"drawArrays drawElements drawArraysInstanced drawBuffers drawElementsInstanced drawRangeElements".split(" ").forEach(b=>{a[b]&&(a[b]=c(a[b],this,a))});a.getExtension=((b,d)=>function(){let f=b.apply(a,arguments);["drawElementsInstancedANGLE"].forEach(a=>{f[a]&&(f[a]=c(f[a],d,f))});return f})(a.getExtension,this)}this.withoutUI||(this.dom=document.getElementById("gl-bench"),this.dom||(document.body.insertAdjacentHTML("afterbegin",'<div id="gl-bench"></div>'),document.body.insertAdjacentHTML("afterbegin",
'<style id="gl-bench-style">'+this.css+"</style>"),this.dom=document.getElementById("gl-bench")),this.dom.addEventListener("click",()=>{this.withoutGPU=!this.withoutGPU;setTimeout(()=>{[].forEach.call(this.nodes["gl-gpu-svg"],a=>{a.style.display=this.withoutGPU?"none":"inline"})},500)}),this.paramLogger=((a,b,d)=>{this.names=d;d="gl-cpu gl-gpu gl-mem gl-fps gl-gpu-svg gl-chart".split(" ");this.nodes=Object.assign({},d);d.forEach(a=>this.nodes[a]=b.getElementsByClassName(a));return(b,d,c,e,h,g,k)=>
{this.nodes["gl-cpu"][b].style.strokeDasharray=(.27*d).toFixed(0)+" 100";this.nodes["gl-gpu"][b].style.strokeDasharray=(.27*c).toFixed(0)+" 100";this.nodes["gl-mem"][b].innerHTML=this.names[b]?this.names[b]:"mem:"+e.toFixed(0)+"mb";this.nodes["gl-fps"][b].innerHTML=h.toFixed(0)+" FPS";a(this.names[b],d,c,e,h,g,k)}})(this.paramLogger,this.dom,this.names),this.chartLogger=((a,b)=>{this.wtf=Object.assign({},["gl-chart"]);this.wtf["gl-chart"]=b.getElementsByClassName("gl-chart");return(b,c,e)=>{let d=
"";for(let a=0;a<c.length;a++){let b=(e+a+1)%c.length;void 0!=c[b]&&(d=d+" "+(55*a/(c.length-1)).toFixed(1)+","+(46-24*c[b]/60).toFixed(1))}this.wtf["gl-chart"][b].setAttribute("points",d);a(this.names[b],c,e)}})(this.chartLogger,this.dom))}addUI(a){-1==this.names.indexOf(a)&&(this.names.push(a),this.dom&&this.dom.insertAdjacentHTML("beforeend",this.svg),this.cpuAccums.push(0),this.gpuAccums.push(0),this.activeAccums.push(!1))}nextFrame(a){this.frameId++;a=a?a:this.now();if(2>this.frameId)this.frameStart=
this.frameId,this.timeStart=a;else{var c=a-this.timeStart;if(1E3<=c){var e=this.frameId-this.frameStart,b=e/c*1E3;for(let a=0;a<this.names.length;a++)this.paramLogger(a,this.cpuAccums[a]/c*100,this.gpuAccums[a]/c*100,performance&&performance.memory?performance.memory.usedJSHeapSize/1048576:0,b,c,e),this.cpuAccums[a]=0,this.gpuAccums[a]=0;this.frameStart=this.frameId;this.timeStart=a}}if(2>this.frameId)this.circularId=0,this.prevFrame=this.frameId,this.zerotime=a;else for(c=a-this.zerotime,e=20*c/
1E3;0<--e;){this.chart[this.circularId%this.chartLen]=(this.frameId-this.prevFrame)/c*1E3;for(b=0;b<this.names.length;b++)this.chartLogger(b,this.chart,this.circularId);this.circularId++;this.prevFrame=this.frameId;this.zerotime=a}}begin(a){this.updateAccums(a)}end(a){this.updateAccums(a)}updateAccums(a){let c=this.names.indexOf(a);-1==c&&(c=this.names.length,this.addUI(a));a=this.now();let e=a-this.t0;for(let a=0;a<c+1;a++)this.activeAccums[a]&&(this.cpuAccums[a]+=e);this.activeAccums[c]=!this.activeAccums[c];
this.t0=a}}return g}();
