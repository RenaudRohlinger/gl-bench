'use strict';var GlBench=function(){class d{constructor(a,b,c,d){this.fpsLogger=a;this.measureLogger=b?b:()=>{};this.gl=c;this.ext=d;this.measureAccum=this.elapsedAccum=this.frameId=0;this.queue=[{query:this.gl.createQuery(),isMeasure:!1,frameId:this.frameId}]}begin(){if("undefined"==typeof this.queryId)this.queryId=0,this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queue[0].query);else{this.frameId++;for(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)&&
this.queue[this.queryId]&&this.gl.getQueryParameter(this.queue[this.queryId].query,this.gl.QUERY_RESULT_AVAILABLE);){var a=this.gl.getQueryParameter(this.queue[this.queryId].query,this.gl.QUERY_RESULT);this.elapsedAccum+=a;this.measureAccum+=this.queue[this.queryId].isMeasure?a:0;a=this.elapsedAccum/1E9;this.queryId++;if(1<=a){let b=(this.queue[this.queryId-1].frameId-this.queue[0].frameId)/a;for(;1<=a;)this.fpsLogger(b),this.measureLogger(this.measureAccum/this.elapsedAccum),a--;for(a=0;a<this.queryId;a++)this.gl.deleteQuery(this.queue[a].query);
this.queue.splice(0,this.queryId);this.queryId=this.measureAccum=this.elapsedAccum=0}}this.queue.push({query:this.gl.createQuery(),isMeasure:!1,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queue[this.queue.length-1].query)}}end(){this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);this.queue[this.queue.length-1].isMeasure=!0;this.queue.push({query:this.gl.createQuery(),isMeasure:!1,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queue[this.queue.length-
1].query)}}class e{constructor(a,b){this.fpsLogger=a;this.measureLogger=b?b:()=>{};this.measureAccum=this.frameCount=0}now(){return"undefined"==typeof performance?Date.now():performance.now()}begin(){if("undefined"==typeof this.zerotime)this.timestamp=this.zerotime=this.now();else{this.frameCount++;this.timestamp=this.now();let a=this.timestamp-this.zerotime,b=a/1E3;if(1<=b){let c=this.frameCount/b;for(;1<=b;)this.fpsLogger(c),this.measureLogger(this.measureAccum/a),b--;this.frameCount=this.measureAccum=
0;this.zerotime=this.timestamp}}}end(){this.measureAccum+=this.now()-this.timestamp}}class f{constructor(a,b){this.fpsLogger=a;this.counterLogger=b}init(a){if(!a){var b=document.getElementsByTagName("canvas");for(let c=0;c<b.length;c++)if(0==c||a.width*a.height<b[c].width*b[c].height)a=b[c]}if(a&&"function"==typeof a.getContext){if(b=a.getContext("webgl")||a.getContext("experimental-webgl")){if(a=b.getExtension("EXT_disjoint_timer_query"))b.createQuery=a.createQueryEXT.bind(a),b.deleteQuery=a.deleteQueryEXT.bind(a),
b.beginQuery=a.beginQueryEXT.bind(a),b.endQuery=a.endQueryEXT.bind(a),b.getQueryParameter=a.getQueryObjectEXT.bind(a),b.QUERY_RESULT_AVAILABLE=a.QUERY_RESULT_AVAILABLE_EXT,b.QUERY_RESULT=a.QUERY_RESULT_EXT}else a=(b=a.getContext("webgl2"))?b.getExtension("EXT_disjoint_timer_query_webgl2"):null;this.gpu=new d(this.fpsLogger,this.counterLogger,b,a)}this.cpu=new e(this.fpsLogger,this.counterLogger)}begin(){this.gpu?(this.cpu.begin(),this.gpu.begin()):this.cpu?this.cpu.begin():(this.init(),this.begin())}end(){this.gpu?
(this.gpu.end(),this.cpu.end()):this.cpu&&this.cpu.end()}update(){this.begin()}}return f}();
