'use strict';var GLBench=function(){class m{constructor(a,b={}){this.css="#gl-bench{position:absolute;left:0;top:0;z-index:1000;-webkit-user-select:none;-moz-user-select:none;user-select:none;}#gl-bench div{position:relative;display:block;margin:5px;padding:0 7px 0 10px;background:#6c6;border-radius:15px;cursor:pointer;opacity:0.9;}#gl-bench svg{height:60px;margin:0 -1px;}#gl-bench text{font-family:Helvetica,Arial,sans-serif;font-weight:700;dominant-baseline:middle;text-anchor:middle;}#gl-bench line{stroke-width:5;stroke:#112211;stroke-linecap:round;}#gl-bench polyline{fill:none;stroke:#112211;stroke-linecap:round;stroke-linejoin:round;stroke-width:3.5;}#gl-bench rect{fill:#448844;}#gl-bench .opacity{stroke:#448844;}";
this.svg='<div class="gl-box"><svg viewBox="0 0 55 60"><text x="27" y="56" font-size="0.75em" class="gl-fps">00 FPS</text><text x="28" y="8" font-size="0.55rem" class="gl-mem"></text><rect x="0" y="14" rx="4" ry="4" width="55" height="32"></rect><polyline class="gl-chart"></polyline></svg><svg viewBox="0 0 14 60" class="gl-cpu-svg"><line x1="7" y1="38" x2="7" y2="11" class="opacity"></line><line x1="7" y1="38" x2="7" y2="11" class="gl-cpu" stroke-dasharray="0 27"></line><path transform="translate(1,43) scale(.29)" d="m15 0c-1.6 3e-16 -2.8 1.3-2.8 2.8v4c-2.7 0.68-4.9 2.8-5.5 5.6h-4c-1.5 0-2.8 1.2-2.8 2.8s1.2 2.8 2.8 2.8h3.8v5.7h-3.7c-1.6 0-2.8 1.3-2.8 2.8 3e-16 1.6 1.3 2.8 2.8 2.8h3.9c0.67 2.7 2.8 4.8 5.5 5.5v3.9c0 1.6 1.3 2.8 2.8 2.8 1.6 0 2.8-1.3 2.8-2.8v-3.7h5.7v3.7c0 1.6 1.3 2.8 2.8 2.8 1.6 0 2.8-1.3 2.8-2.8v-3.9c2.7-0.67 4.8-2.8 5.5-5.5h3.9c1.6 0 2.8-1.3 2.8-2.8 0-1.6-1.3-2.8-2.8-2.8h-3.7v-5.7h3.8c1.5 0 2.8-1.2 2.8-2.8s-1.2-2.8-2.8-2.8h-4c-0.65-2.7-2.8-4.9-5.5-5.6v-3.9c0-1.6-1.3-2.8-2.8-2.8-1.6 3e-16 -2.8 1.3-2.8 2.8v3.7h-5.7v-3.7c0-1.6-1.3-2.8-2.8-2.8zm2 12h7.2c2.6 0 4.7 2.1 4.7 4.7v7.2c0 2.6-2.1 4.7-4.7 4.7h-7.2c-2.6 0-4.7-2.1-4.7-4.7v-7.2c0-2.6 2.1-4.7 4.7-4.7z"></path></svg><svg viewBox="0 0 14 60" class="gl-gpu-svg"><line x1="7" y1="38" x2="7" y2="11" class="opacity"></line><line x1="7" y1="38" x2="7" y2="11" class="gl-gpu" stroke-dasharray="0 27"></line><path transform="translate(0.93,43) scale(1.15)" d="m0.885 0.328a0.64 0.64 0 1 0-0.00362 1.28c0.509 0.00201 0.491 0.112 0.552 0.278 0.061 0.165 0.0429 0.379 0.0429 0.379l-0.00568 0.047v7.54a0.64 0.64 0 1 0 1.28 0v-1.23c0.22 0.0828 0.459 0.13 0.711 0.13h4.58c1.09 0 1.96-0.848 1.96-1.9v-2.7c0-1.05-0.875-1.9-1.96-1.9h-4.58c-0.251 0-0.49 0.047-0.71 0.13 0.0157-0.143 0.0366-0.52-0.118-0.938-0.195-0.528-0.826-1.11-1.75-1.11zm2.53 3.17c0.369 0 0.666 0.315 0.666 0.706v2.59c0 0.391-0.297 0.706-0.666 0.706s-0.666-0.315-0.666-0.706v-2.59c0-0.391 0.297-0.706 0.666-0.706zm3.58 0a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2z"></path></svg></div>';
this.paramLogger=()=>{};this.chartLogger=()=>{};this.chartHz=this.chartLen=20;this.names=[];this.cpuAccums=[];this.gpuAccums=[];this.activeAccums=[];this.chart=Array(this.chartLen);this.now=()=>performance&&performance.now?performance.now():Date.now();this.updateUI=()=>{[].forEach.call(this.nodes["gl-gpu-svg"],a=>{a.style.display=this.trackGPU?"inline":"none"})};Object.assign(this,b);this.frameId=this.detected=0;let e,c=0,d,h=a=>{10>++c?e=requestAnimationFrame(h):(this.detected=Math.ceil(1E3*c/(a-
d)/80),cancelAnimationFrame(e));d||(d=a)};requestAnimationFrame(h);this.withoutUI||(this.dom=document.getElementById("gl-bench"),this.dom||(document.body.insertAdjacentHTML("afterbegin",'<div id="gl-bench"></div>'),document.body.insertAdjacentHTML("afterbegin",'<style id="gl-bench-style">'+this.css+"</style>"),this.dom=document.getElementById("gl-bench")),this.dom.addEventListener("click",()=>{this.trackGPU=!this.trackGPU;setTimeout(()=>{this.updateUI()},500)}),this.paramLogger=((a,b,g)=>{let c="gl-cpu gl-gpu gl-mem gl-fps gl-gpu-svg gl-chart".split(" "),
f=Object.assign({},c);c.forEach(a=>f[a]=b.getElementsByClassName(a));this.nodes=f;return(b,c,l,d,k,e,n)=>{f["gl-cpu"][b].style.strokeDasharray=(.27*c).toFixed(0)+" 100";f["gl-gpu"][b].style.strokeDasharray=(.27*l).toFixed(0)+" 100";f["gl-mem"][b].innerHTML=g[b]?g[b]:d?"mem:"+d.toFixed(0)+"mb":"";f["gl-fps"][b].innerHTML=k.toFixed(0)+" FPS";a(g[b],c,l,d,k,e,n)}})(this.paramLogger,this.dom,this.names),this.chartLogger=((a,b)=>{let c={"gl-chart":b.getElementsByClassName("gl-chart")};return(b,f,d)=>{let g=
"";for(let a=0;a<f.length;a++){let b=(d+a+1)%f.length;void 0!=f[b]&&(g=g+" "+(55*a/(f.length-1)).toFixed(1)+","+(45-22*f[b]/60/this.detected).toFixed(1))}c["gl-chart"][b].setAttribute("points",g);a(this.names[b],f,d)}})(this.chartLogger,this.dom));if(a){let b=(b,c,d)=>function(){const f=c.now();b.apply(d,arguments);if(c.trackGPU){a.readPixels(0,0,1,1,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(4));const b=c.now()-f;c.activeAccums.forEach((a,d)=>{a&&(c.gpuAccums[d]+=b,c.cpuAccums[d]-=b)})}};"drawArrays drawElements drawArraysInstanced drawBuffers drawElementsInstanced drawRangeElements".split(" ").forEach(c=>
{a[c]&&(a[c]=b(a[c],this,a))});a.getExtension=((c,d)=>function(){let e=c.apply(a,arguments);["drawElementsInstancedANGLE","DRAW_BUFFER0_WEBGL"].forEach(a=>{e[a]&&(e[a]=b(e[a],d,e))});return e})(a.getExtension,this)}}addUI(a){-1==this.names.indexOf(a)&&(this.names.push(a),this.dom&&(this.dom.insertAdjacentHTML("beforeend",this.svg),this.updateUI()))}nextFrame(a){this.frameId++;a=a?a:this.now();if(1>=this.frameId)this.paramFrame=this.frameId,this.paramTime=a,this.circularId=0;else{var b=a-this.paramTime;
if(1E3<=b){var e=this.frameId-this.paramFrame,c=e/b*1E3;for(let a=0;a<this.names.length;a++)this.paramLogger(a,this.cpuAccums[a]/b*100,this.gpuAccums[a]/b*100,performance&&performance.memory?performance.memory.usedJSHeapSize/1048576:0,c,b,e),this.cpuAccums[a]=0,this.gpuAccums[a]=0;this.paramFrame=this.frameId;this.paramTime=a}b=a-this.chartTime;e=this.chartHz*b/1E3;if(this.detected)for(;0<--e&&this.detected;){this.chart[this.circularId%this.chartLen]=(this.frameId-this.chartFrame)/b*1E3;for(c=0;c<
this.names.length;c++)this.chartLogger(c,this.chart,this.circularId);this.circularId++;this.chartFrame=this.frameId;this.chartTime=a}else this.chartFrame=this.frameId,this.chartTime=a}}begin(a){this.updateAccums(a)}end(a){this.updateAccums(a)}updateAccums(a){let b=this.names.indexOf(a);-1==b&&(b=this.names.length,this.addUI(a),this.cpuAccums.push(0),this.gpuAccums.push(0),this.activeAccums.push(!1));a=this.now();let e=a-this.t0;for(let a=0;a<b+1;a++)this.activeAccums[a]&&(this.cpuAccums[a]+=e);this.activeAccums[b]=
!this.activeAccums[b];this.t0=a}}return m}();
