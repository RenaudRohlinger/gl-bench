'use strict';var GLBench=function(){class g{constructor(b,a,c,d){this.fpsLogger=c?c:()=>{};this.gpuLogger=d?d:()=>{};this.frameId=0;this.namedAccums=[];this.queryId=this.measureMode=0;this.queryQueue=[];this.totalAccum=0;a&&"EXTDisjointTimerQuery"==a.constructor.name&&(b.createQuery=a.createQueryEXT.bind(a),b.deleteQuery=a.deleteQueryEXT.bind(a),b.beginQuery=a.beginQueryEXT.bind(a),b.endQuery=a.endQueryEXT.bind(a),b.getQueryParameter=a.getQueryObjectEXT.bind(a),b.QUERY_RESULT_AVAILABLE=a.QUERY_RESULT_AVAILABLE_EXT,
b.QUERY_RESULT=a.QUERY_RESULT_EXT);this.gl=b;this.ext=a}begin(b){0===b&&this.frameId++;this.namedAccums.length<=b&&this.namedAccums.push(0);if(1!=this.frameId)for(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)&&this.queryQueue[this.queryId]&&this.gl.getQueryParameter(this.queryQueue[this.queryId].query,this.gl.QUERY_RESULT_AVAILABLE);){var a=this.gl.getQueryParameter(this.queryQueue[this.queryId].query,this.gl.QUERY_RESULT);this.totalAccum+=a;var c=this.queryQueue[this.queryId].measureMode.toString(2);
for(var d=0;d<c.length;d++)"1"==c[d]&&(this.namedAccums[c.length-d-1]+=a);this.queryId++;a=this.totalAccum/1E9;if(1<=a){c=(this.queryQueue[this.queryId-1].frameId-this.queryQueue[0].frameId)/a;for(d=this.namedAccums.map(a=>100*a/this.totalAccum);1<=a;){for(let a=0;a<this.namedAccums.length;a++)this.fpsLogger(c,a),this.gpuLogger(d[a],a);a--}this.queryQueue.slice(0,this.queryId).forEach(a=>this.gl.deleteQuery(a.query));this.queryQueue.splice(0,this.queryId);for(a=this.namedAccums.length;a--;)this.namedAccums[a]=
0;this.queryId=this.totalAccum=0}}this.measureMode+=1<<b;this.queryQueue.push({query:this.gl.createQuery(),measureMode:this.measureMode,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queryQueue[this.queryQueue.length-1].query)}end(b){this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);this.measureMode-=1<<b;this.queryQueue.push({query:this.gl.createQuery(),measureMode:this.measureMode,frameId:this.frameId});this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queryQueue[this.queryQueue.length-
1].query)}}class f{constructor(b,a){this.fpsLogger=b?b:()=>{};this.cpuLogger=a?a:()=>{};this.frameId=0;this.namedAccums=[];this.measureMode=0;this.zerotime=null;this.timestamp=0}now(){return performance&&performance.now?performance.now():Date.now()}begin(b){0===b&&this.frameId++;this.namedAccums.length<=b&&this.namedAccums.push(0);this.timestamp=this.now();if(null==this.zerotime)this.zerotime=this.timestamp;else{let b=this.timestamp-this.zerotime;var a=b/1E3;if(1<=a){let d=this.frameId/a,c=this.namedAccums.map(a=>
100*a/b);for(;1<=a;){for(let a=0;a<this.namedAccums.length;a++)this.fpsLogger(d,a),this.cpuLogger(c[a],a);a--}for(a=this.namedAccums.length;a--;)this.namedAccums[a]=0;this.frameId=0;this.zerotime=this.timestamp}}this.measureMode+=1<<b}end(b){let a=this.now()-this.timestamp,c=this.measureMode.toString(2);for(let b=0;b<c.length;b++)"1"==c[b]&&(this.namedAccums[c.length-b-1]+=a);this.measureMode-=1<<b}}class h{constructor(b={},a=!0){this.isDefaultUI=a;Object.assign(this,b);this.names=[]}init(b){let a,
c;b instanceof HTMLCanvasElement&&(b=b.getContext("webgl")||b.getContext("experimental-webgl")||b.getContext("webgl2"));b instanceof WebGLRenderingContext?(c=b,a=c.getExtension("EXT_disjoint_timer_query")):b instanceof WebGL2RenderingContext&&(c=b,a=c.getExtension("EXT_disjoint_timer_query_webgl2"));if(this.isDefaultUI){var d=function(a,b,c,d,f){this.elm=e.getElementsByClassName(a);this.prgr=e.getElementsByClassName(c);return(a,c)=>{this.elm[c].innerHTML=b(a);this.prgr[c].style.fill=d(a);f&&f(a)}};
b=b instanceof HTMLCanvasElement?b.parentNode:document.body;let c=document.getElementById("gl-bench-dom");if(!c){c=document.createElement("div");c.id="gl-bench-dom";c.style.cssText="position:absolute;left:0;top:0;margin:0;";let a=document.createElement("style");a.innerHTML=".gl-bench {\n  position: relative;\n  display: block;\n  margin: 5px;\n  width: 100px;\n}\n\n.gl-box {\n  fill: hsla(120, 50%, 60%, 0.65);\n}\n\n.gl-text {\n  font-family: sans-serif;\n  font-weight: 700;\n  font-size: 0.7em;\n  dominant-baseline: middle;\n  text-anchor: middle;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  opacity: 0.7;\n}\n\n.gl-arc {\n  fill: none;  \n  stroke: black;\n  stroke-width: 2.6;\n  opacity: 0.5;  \n  transform: scale(1.25663);\n  stroke-dasharray: 0, 100;\n}\n\n.gl-circle {\n  fill: none;\n  stroke: black;\n  opacity: 0.4;\n}";
c.appendChild(a)}let e=document.createElement("template");e.innerHTML=a?'<svg viewBox="0 0 100 70" class="gl-bench">\n\n<rect x="0" y="0" width="100" height="70" rx="26.5" ry="26.5" class="gl-box"/>\n\n<text x="26.5" y="22" class="gl-text gl-cpu">00%</text>\n<text x="26.5" y="34" class="gl-text">CPU</text>\n<circle cx="26.5" cy="26.5" r="20" stroke-width="3.5" class="gl-circle"/>\n<path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"\n  class="gl-arc gl-cpu-arc"/>\n\n<circle cx="73.5" cy="26.5" r="20" stroke-width="3.5" class="gl-circle"/>\n<text x="73.5" y="22" class="gl-text gl-gpu">00%</text>\n<text x="73.5" y="34" class="gl-text">GPU</text>\n<path d="M58.5 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"\n  class="gl-arc gl-gpu-arc"/>\n\n<text x="50" y="59" font-size=".8em" class="gl-text gl-fps">00 FPS</text>\n<circle cx="18" cy="58" r="3" style="opacity:0.55"/>\n<circle cx="82" cy="58" r="3" style="opacity:0.55"/>\n\n</svg>':
'<svg viewBox="0 0 100 52.632" class="gl-bench">\n\n<rect x="0" y="0" width="100" height="52.632" rx="26.5" ry="26.5" class="gl-box"/>\n\n<text x="26.5" y="22" class="gl-text gl-cpu">00%</text>\n<text x="26.5" y="34" class="gl-text">CPU</text>\n<circle cx="26.5" cy="26.5" r="20" stroke-width="3.5" class="gl-circle"/>\n<path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"\n  stroke-dasharray="0, 100" class="gl-arc gl-cpu-arc"/>\n\n<text x="74" y="28" font-size="0.8em" class="gl-text gl-fps">00 FPS</text>\n\n</svg>';
e=e.content.firstChild;c.appendChild(e);b.appendChild(c);this.cpuLogger=d.bind({})("gl-cpu",a=>a.toFixed(0)+"%","gl-cpu-arc",a=>a.toFixed(0)+", 100",this.cpuLogger);this.fpsLogger=d.bind({})("gl-fps",a=>a.toFixed(0)+" FPS","gl-box",a=>"hsla("+Math.min(120,Math.max(0,2.182*(a-5))).toFixed(0)+", 50%, 60%, 0.65)",this.fpsLogger);this.gpuLogger=a?d.bind({})("gl-gpu",a=>a.toFixed(0)+"%","gl-gpu-arc",a=>a.toFixed(0)+", 100",this.gpuLogger):null}a?(this.cpu=new f(null,this.cpuLogger),this.gpu=new g(c,a,
this.fpsLogger,this.gpuLogger)):this.cpu=new f(this.fpsLogger,this.cpuLogger)}begin(b){let a=this.names.indexOf(b);-1==this.names.indexOf(b)&&(a=this.names.length,this.names.push(b));this.gpu?(this.cpu.begin(a),this.gpu.begin(a)):this.cpu?this.cpu.begin(a):(this.init(),this.begin(a))}end(b){b=this.names.indexOf(b);this.gpu?(this.cpu.end(b),this.gpu.end(b)):this.cpu&&this.cpu.end(b)}update(){this.begin();this.end()}}return h}();
