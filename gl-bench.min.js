'use strict';var GlBench=function(){function e(){if(void 0===this.gpuFrames)this.queries=[this.gl.createQuery()],this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries[0]),this.gpuFrames=0,this.nanosec=[],this.duration=0;else{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);if(!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))for(let b=this.gpuFrames;b<this.queries.length&&this.gl.getQueryParameter(this.queries[b],this.gl.QUERY_RESULT_AVAILABLE);b++){this.gpuFrames++;this.nanosec.push(this.gl.getQueryParameter(this.queries[b],
this.gl.QUERY_RESULT));this.duration+=this.nanosec[this.nanosec.length-1];var a=this.duration/1E9;if(1<=a){let c=this.gpuFrames/a;for(;1<=a;)this.fpsLogger(c),a--;this.startCounter&&this.endCounter&&g.bind(this)(b);for(a=0;a<b;b++)this.gl.deleteQuery(this.queries[b]);this.queries.splice(0,b);this.nanosec.splice(0,b);this.duration=this.gpuFrames=0}}this.queries.push(this.gl.createQuery());this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries[this.queries.length-1])}}function h(){void 0===this.startCounter&&
(this.startCounter=[],this.finishCounter=[]);this.startCounter.push(this.gl.createQuery());this.finishCounter.push(this.gl.createQuery());this.ext.queryCounterEXT(this.startCounter[this.startCounter.length-1],this.ext.TIMESTAMP_EXT)}function k(){this.ext.queryCounterEXT(this.finishCounter[this.finishCounter.length-1],this.ext.TIMESTAMP_EXT)}function g(a){var b=0;let c=0;for(let a=0,e=Math.min(this.startCounter.length,this.finishCounter.length,this.nanosec.length);a<e;a++){var d=this.gl.getQueryParameter(this.finishCounter[a],
this.gl.QUERY_RESULT_AVAILABLE),f=this.gl.getQueryParameter(this.finishCounter[a],this.gl.QUERY_RESULT_AVAILABLE);d&&f&&(d=this.gl.getQueryParameter(this.startCounter[a],this.gl.QUERY_RESULT),f=this.gl.getQueryParameter(this.finishCounter[a],this.gl.QUERY_RESULT),b+=(f-d)/1E9,c+=this.nanosec[a])}this.counterLogger(b/c);for(b=0;b<a;b++)this.gl.deleteQuery(this.startCounter[a]),this.gl.deleteQuery(this.finishCounter[a]);this.startCounter.splice(0,a);this.finishCounter.splice(0,a)}function d(){return(window.performance||
Date).now()}function l(){if(void 0===this.frames)this.frames=0,this.prevTime=d();else{this.frames++;let a=d();this.ms=a-this.prevTime;let b=this.ms/1E3;if(1<=b){let c=this.frames/b;for(;1<=b;)this.fpsLogger(c),b--;this.frames=0;this.prevTime=a}}}function m(){this.counterBegin=d()}function n(){void 0===this.prevframes?this.counterDuration=0:0===this.frames?(this.counterLogger(this.counterDuration/this.ms),this.counterDuration=0):this.counterDuration+=d()-this.counterBegin;this.prevframes=this.frames}
class p{constructor(a,b){this.fpsLogger="function"==typeof a?a:null;this.counterLogger="function"==typeof a?b:null}initCanvas(a){if(!a){let b=document.getElementsByTagName("canvas");for(let c=0;c<b.length;c++)if(0==c||a.width*a.height<b[c].width*b[c].height)a=b[c]}a&&"function"==typeof a.getContext?(this.gl=a.getContext("webgl")||a.getContext("experimental-webgl"))?(this.ext=this.gl.getExtension("EXT_disjoint_timer_query"),this.gl.createQuery=this.ext.createQueryEXT.bind(this.ext),this.gl.deleteQuery=
this.ext.deleteQueryEXT.bind(this.ext),this.gl.beginQuery=this.ext.beginQueryEXT.bind(this.ext),this.gl.endQuery=this.ext.endQueryEXT.bind(this.ext),this.gl.getQueryParameter=this.ext.getQueryObjectEXT.bind(this.ext),this.gl.QUERY_RESULT_AVAILABLE=this.ext.QUERY_RESULT_AVAILABLE_EXT,this.gl.QUERY_RESULT=this.ext.QUERY_RESULT_EXT):this.ext=(this.gl=a.getContext("webgl2"))?this.gl.getExtension("EXT_disjoint_timer_query_webgl2"):null:console.log("CPU fallback");this.inited=!0}update(){this.ext?e.bind(this)():
this.inited?l.bind(this)():(this.initCanvas(),this.update())}begin(){this.ext?h.bind(this)():this.inited?m.bind(this)():(this.initCanvas(),this.begin())}end(){this.ext?k.bind(this)():this.inited&&n.bind(this)()}}return p}();
